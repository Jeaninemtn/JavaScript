<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="EXPIRES" CONTENT="0">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <title>Quick Diagnosis Topology Map</title>
    <link rel=icon href=images/favicon.ico>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type=text/javascript src=sha256.js></script>
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="vis-network.min.js"></script>
    <link href="vis-network.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="tabble.js"></script>
    <script type="text/javascript" src="js/snmp_common.js"></script>
    <script type="text/javascript" src="js/snmp_functions.js"></script>
    <script type="text/javascript" src="js/snmp_discovery.js"></script>
    <script type="text/javascript">
        var canvas_width = 2700;
        var canvas_height = 1800;
        var network_draw_ready = 0;
        var master_enabled = 1;
        var lldp_init_neighbor_ready = 0;
        var lldp_lock_neighbor_ready = 0;
        var lldp_lock_neighbor_xy_ready = 0;
        var lldp_neighbor_ready = 0;
        var lldp_init_topology_ready = 0;
        var lldp_ems_images_ready = 0;
        var lldp_manual_neighbor_ready = 0;
        var lldp_manual_neighbor_xy_ready = 0;
        var lldp_manual_neighbor_ping_ready = 0;
        var lldp_move_neighbor_ready = 0;
        var local_product_name = '';
        var local_system_name = '';
        var local_location_name = '';
        var local_ip = '';
        var local_mac = '';
        var local_id = 1;
        var local_alarm_info = 0;
        var neighbor_product_name = [];
        var neighbor_system_name = [];
        var neighbor_location_name = [];
        var neighbor_ip = [];
        var neighbor_mac = [];
        var neighbor_cid = [];
        var neighbor_with_host_port = [];
        var neighbor_parent_id = [];
        var neighbor_local_port = [];
        var neighbor_ems_client = [];
        var neighbor_poe_supply = [];
        var neighbor_img = [];
        var neighbor_alarm_info = [];
        var neighbor_multicast_remote_set = [];
        var neighbor_under_master_port = [];
        var neighbor_snmp_flag = [];
        var neighbor_snmp_community_string = [];
        var lock_local_x = 0;
        var lock_local_y = 0;
        var lock_neighbor_product_name = [];
        var lock_neighbor_system_name = [];
        var lock_neighbor_location_name = [];
        var lock_neighbor_ip = [];
        var lock_neighbor_mac = [];
        var lock_neighbor_cid = [];
        var lock_neighbor_with_host_port = [];
        var lock_neighbor_parent_id = [];
        var lock_neighbor_local_port = [];
        var lock_neighbor_ems_client = [];
        var lock_neighbor_poe_supply = [];
        var lock_neighbor_img = [];
        var lock_neighbor_alarm_info = [];
        var lock_neighbor_multicast_remote_set = [];
        var lock_neighbor_under_master_port = [];
        var lock_neighbor_snmp_flag = [];
        var lock_neighbor_snmp_community_string = [];
        var lock_neighbor_x = [];
        var lock_neighbor_y = [];
        var manual_neighbor_product_name = [];
        var manual_neighbor_system_name = [];
        var manual_neighbor_location_name = [];
        var manual_neighbor_ip = [];
        var manual_neighbor_mac = [];
        var manual_neighbor_cid = [];
        var manual_neighbor_with_host_port = [];
        var manual_neighbor_parent_id = [];
        var manual_neighbor_local_port = [];
        var manual_neighbor_ems_client = [];
        var manual_neighbor_poe_supply = [];
        var manual_neighbor_img = [];
        var manual_neighbor_alarm_info = [];
        var manual_neighbor_multicast_remote_set = [];
        var manual_neighbor_under_master_port = [];
        var manual_neighbor_x = [];
        var manual_neighbor_y = [];
        var manual_neighbor_ping_check = [];
        var manual_neighbor_snmp_flag = [];
        var manual_neighbor_snmp_community_string = [];
        var move_neighbor_mac = [];
        var move_neighbor_with_host_port = [];
        var move_neighbor_parent_id = [];
        var move_neighbor_local_port = [];
        var ems_images = [];
        var current_index = 0;
        var topology_style = 0;
        var lock_state = 0;
        var label_state = 0;
        var edges_state = 1;
        var current_topology_style = 0;
        var current_lock_state = 0;
        var ddms = 0;
        var bg_type = 1;;
        var bg_color = '#FFFFFF';
        var bg_image = "images/empty.png";
        var map_size_width = 0;
        var map_size_height = 0;

    </script>
</head>
<style type='text/css'>
    @charset "utf-8";
    @import "css/dialog.css";

    .loader {
        position: absolute;
        left: 50%;
        top: 35%;
        z-index: 1;
        width: 120px;
        height: 120px;
        margin: -76px 0 0 -76px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    * {
        margin: 0px;
        padding: 0px;
    }

    body {
        background-color: #FFFFFF;
        font-family: Microsoft JhengHei;
    }

    #wrapper {
        margin: 0px;
        padding: 0px;
        width: 100%;
    }

    h1 {
        color: #3E5C7F;
        text-align: left;
        margin-bottom: 0px;
    }

    h2 {
        color: #3E5C7F;
        text-align: left;
        margin-bottom: 0px;
    }

    p {
        text-align: left;
        font-size: 16px;
        margin-bottom: 0px;
    }

    #logo {
        height: 110px;
        max-width: 50%;
    }

    #mynetwork {
        width: 0;
        height: 0;
        border: none;
        border: 1px solid black;
        top: 60;
        left: 0;
        position: absolute;
    }

    table {
        border-collapse: collapse;
        font-size: 12px;
        border: 0px;
    }

    th,
    td {
        text-align: left;
        padding: 5px;
    }

    tr:nth-child(even) {
        background-color: #FFFFFF
    }

    tr:nth-child(odd) {
        background-color: #E6E6E6
    }

    th {
        background-color: #808080;
        color: white;
    }

    #frame_info {
        padding: 0px 0px;
        display: inline-block;
        border: none;
        border-radius: 0px;
        margin-left: 0px;
    }

    #frame_info div {
        padding: 0px 0px;
        display: inline-block;
        border: none;
        border-radius: 30px;
        margin-left: 0px;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #0d0d0d;
        min-width: 160px;
        overflow: auto;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
    }

    .dropdown-content a {
        font-size: 14px;
        color: white;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        border: solid;
        border-color: #56616A;
    }

    .dropdown-content a:hover {
        background-color: #56616A;
    }

    .dropdown-content-icon {
        display: none;
        position: absolute;
        background-color: #ffffff;
        min-width: 140px;
        max-width: 140px;
        overflow: auto;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
    }

    .dropdown-content-icon a {
        font-size: 8px;
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        border: solid;
        border-color: #56616A;
    }

    .dropdown-content-icon a:hover {
        background-color: #ffffff;
    }
</style>
<script>
    //var url = new URL(document.location);
    var url = document.location.toString();
    var rd = "rd";
    var csrf_token = "";
    var browser_csrf_token = "";
    var current_mac = "";
    var current_img = "";
    var current_select_img = "";
    var current_img_name = "";
    var current_img_index = 0;
    var debug_test = 0;
    var ems_just_set_icon_id = "";
    var dragging_mac = 0;
    var dragging_flag = 0;
    var host_alarm_image_offset_x = 36;
    var host_alarm_image_offset_y = -36;
    var alarm_image_offset_x = 26;
    var alarm_image_offset_y = -22;
    var demo = 0;
    /* ie not support
    if (url.searchParams.get("r")!=null)
    {
          if (url.searchParams.get("r")==0)
              rd = "";
          if (url.searchParams.get("r")==2)
          {
              rd = "";
              demo=1;
          }
    }
    if (url.searchParams.get("csrf_token")!=null)
          csrf_token=url.searchParams.get("csrf_token");
    */

    // ------------------------------------------------

    var n = url.search("r=");  // 找r的位置
    if (n != -1) {
        //if (url.substr(n + 2, 1) == "0") 
        //    rd = "";

        // substr(string, start point, length);
        // string=要找的字串列
        // start=開始的位置
        // length=規定回傳的字串長度(optional) 所以下面這行沒有規定

        if (url.substr(n + 2, 1) == "2") {  
            // 找r位置下下一個的值是誰 如果等於2就執行
            rd = "";
        }
    }
    else {  // 如果不等於2 那就導回登入頁面
        document.location.href = "login.htm";
    }


    // ------------------------------------------------


    n = url.search("csrf_token=");
    if (n != -1)  // 如果有找到
        csrf_token = url.substr(n + 11, 32);  // 給token值
    else {  // 如果沒找到
        document.location.href = "login.htm";  // 回登入頁面
    }

    
    // ------------------------------------------------


    function onUpIcon(add_new) {
        var tmp_img = "";
        var tmp_img_name = "";

        if (current_img_index == 0) {
            current_img_index = ems_images.length;
        }
        else {
            current_img_index--;
        }
        if (current_img_index == 0) {
            tmp_img = current_img;
            current_select_img = tmp_img;
            if (add_new)
                document.getElementById("add_icon_img").src = current_select_img;
            else
                document.getElementById("icon_img").src = current_select_img;
            tmp_img_name = tmp_img;
            tmp_img_name = tmp_img.replace("ems_images/", "");
            tmp_img_name = tmp_img_name.replace(".gif", "");
            tmp_img_name = tmp_img_name.replace(".png", "");
            tmp_img_name = tmp_img_name.replace("-unknown", "");
            if (add_new)
                document.getElementById("add_icon_name").innerHTML = "[" + tmp_img_name + "]";
            else
                document.getElementById("icon_name").innerHTML = "[" + tmp_img_name + "]";
        }
        else {
            tmp_img = ems_images[current_img_index - 1];
            current_select_img = "ems_images/" + tmp_img;
            if (add_new)
                document.getElementById("add_icon_img").src = current_select_img;
            else
                document.getElementById("icon_img").src = current_select_img;
            tmp_img_name = tmp_img;
            tmp_img_name = tmp_img_name.replace(".gif", "");
            tmp_img_name = tmp_img_name.replace(".png", "");
            tmp_img_name = tmp_img_name.replace("-unknown", "");
            if (add_new)
                document.getElementById("add_icon_name").innerHTML = "[" + tmp_img_name + "]";
            else
                document.getElementById("icon_name").innerHTML = "[" + tmp_img_name + "]";
        }
    }

    function onDownIcon(add_new) {
        var tmp_img = "";
        var tmp_img_name = "";

        if (current_img_index == ems_images.length) {
            current_img_index = 0;
        }
        else {
            current_img_index++;
        }
        if (current_img_index == 0) {
            tmp_img = current_img;
            current_select_img = tmp_img;
            if (add_new)
                document.getElementById("add_icon_img").src = current_select_img;
            else
                document.getElementById("icon_img").src = current_select_img;
            tmp_img_name = tmp_img;
            tmp_img_name = tmp_img.replace("ems_images/", "");
            tmp_img_name = tmp_img_name.replace(".gif", "");
            tmp_img_name = tmp_img_name.replace(".png", "");
            tmp_img_name = tmp_img_name.replace("-unknown", "");
            if (add_new)
                document.getElementById("add_icon_name").innerHTML = "[" + tmp_img_name + "]";
            else
                document.getElementById("icon_name").innerHTML = "[" + tmp_img_name + "]";
        }
        else {
            tmp_img = ems_images[current_img_index - 1];
            current_select_img = "ems_images/" + tmp_img;
            if (add_new)
                document.getElementById("add_icon_img").src = current_select_img;
            else
                document.getElementById("icon_img").src = current_select_img;
            tmp_img_name = tmp_img;
            tmp_img_name = tmp_img_name.replace(".gif", "");
            tmp_img_name = tmp_img_name.replace(".png", "");
            tmp_img_name = tmp_img_name.replace("-unknown", "");
            if (add_new)
                document.getElementById("add_icon_name").innerHTML = "[" + tmp_img_name + "]";
            else
                document.getElementById("icon_name").innerHTML = "[" + tmp_img_name + "]";
        }
    }

    function checkMACFormat(mac) {
        mac = mac.toLowerCase();
        if (mac.indexOf("00:00:00:00:00:00") == 0 || mac.indexOf("ff:ff:ff:ff:ff:ff") == 0) {
            return false;
        }
        if (mac.search(/^\S{2}\:\S{2}\:\S{2}\:\S{2}\:\S{2}\:\S{2}$/) != -1) {
            var myArray = mac.split(/\:/);
            for (i = 0; i < 6; i++) {
                if (myArray[i].search(/[^a-f0-9]/) != -1) {
                    return false;
                }
            }
        } else {
            return false;
        }
        return true;
    }

      
    // ------------------------------------------------

    // TODO: 搞懂這行在幹嘛

    // zeroPad是一個function 執行後會回傳字串(箭頭後面那串)
    const zeroPad = (num, places) => String(num).padStart(places, '0')

    // padStart()
    // syntax -> str.padStart(targetLength, padString)
    // targetLength=預計要填充到的字串長度
    // padString=要用什麼字串來填充(optional) 沒有填寫的話就會用空白去填

    // ------------------------------------------------


    function str2hex(str) {
        var arr1 = [];
        for (var n = 0, l = str.length; n < l; n++) {
            var hex = Number(str.charCodeAt(n)).toString(16);
            arr1.push(hex);
        }
        return arr1.join('');
    }

    function onSetIcon(add_new) {
        var tmp_img = current_select_img;
        var tmp_img_name = tmp_img.replace("ems_images/", "");
        current_img = tmp_img;
        if (add_new) {
            if ((document.getElementById("AddIP").value != "") && (!checkIPFormat(document.getElementById("AddIP").value))) {
                return false;
            }
            if (checkMACFormat(document.getElementById('AddMAC').value))
                current_mac = mac17_to_mac12(document.getElementById('AddMAC').value)
            else {
                alert("MAC address error!");
                return false;
            }
            if (document.getElementById("AddProductName").value == "") {
                alert("Product Name cannot be empty!");
                return false;
            }
            if (document.getElementById("AddSystemName").value == "") {
                alert("System Name cannot be empty!");
                return false;
            }
            if ((document.getElementById("AddParentMAC").value != "00:00:00:00:00:00") && (!checkMACFormat(document.getElementById("AddParentMAC").value))) {
                alert("Parent MAC address error!");
                return false;
            }
            if ((document.getElementById("AddParentPort").value == "") || (isNaN(parseInt(document.getElementById("AddParentPort").value, 10)))) {
                alert("Parent Port error!");
                return false;
            }
            if ((document.getElementById("AddLocalPort").value == "") || (isNaN(parseInt(document.getElementById("AddLocalPort").value, 10)))) {
                alert("Local Port error!");
                return false;
            }
            if (document.getElementById("AddSNMP").checked && document.getElementById("AddSNMPCommunityString").value == "") {
                alert("SNMP Community String cannot be empty!");
                return false;
            }
        }
        else {
            setCookie((current_mac + '_img'), current_img, 365);
            nodes.update({ id: current_mac, image: current_img });
            i = neighbor_mac.indexOf(current_mac);
            if (i >= 0) {
                neighbor_img[i] = current_img;
            }
            setCookie('ems_just_set_icon_id', current_mac, 365);
        }
        document.getElementById("myDropdownSetIP").style.display = "none";
        document.getElementById("myDropdownReboot").style.display = "none";
        document.getElementById("myDropdownFactoryDefault").style.display = "none";
        document.getElementById("myDropdownSave").style.display = "none";
        document.getElementById("myDropdownChangeIcon").style.display = "none";
        document.getElementById("myDropdown").style.display = "none";
        document.getElementById("myDropdownAddIcon").style.display = "none";
        document.getElementById("myDropdownEditIcon").style.display = "none";
        document.getElementById("myDropdownMoveEdge").style.display = "none";
        document.getElementById("myDropdownSelectIcon").style.display = "none";
        document.getElementById("myDropdownSNMP").style.display = "none";
        document.getElementById("myDropdownRemoteSetting").style.display = "none";
        if (add_new) {
            var found = 0;
            current_mac = current_mac.toLowerCase();
            if (neighbor_mac.indexOf(current_mac) >= 0)
                found = 1;
            if (manual_neighbor_mac.indexOf(current_mac) >= 0)
                found = 1;
            if (lock_state) {
                if (lock_neighbor_mac.indexOf(current_mac) >= 0)
                    found = 1;
            }
            if (found) {
                alert("Error: This MAC address has already existed in Map.");
                return;
            }
            else {
                if (add_new) {
                    var szAddIP = document.getElementById("AddIP").value;
                    if (szAddIP == "")
                        szAddIP = "0.0.0.0";
                    var szAddProductName = str2hex(document.getElementById("AddProductName").value);
                    var szAddSystemName = str2hex(document.getElementById("AddSystemName").value);
                    var szAddParentMAC = mac17_to_mac12(document.getElementById("AddParentMAC").value);
                    szAddParentMAC = szAddParentMAC.toLowerCase();
                    if (szAddParentMAC == local_mac)
                        szAddParentMAC = "000000000000";


                    // ------------------------------------------------

                    // AddParentPort在dropdownlist裡面
                    // 就是hover device的時候會出現的那條list

                    var szAddParentPort = zeroPad(document.getElementById("AddParentPort").value, 2);
                    var szAddLocalPort = zeroPad(document.getElementById("AddLocalPort").value, 2);

                    // ------------------------------------------------


                    var szAddPingCheck = "0";
                    if (document.getElementById("AddPingCheck").checked)
                        szAddPingCheck = "1";
                    var szAddSNMP = "0";
                    var szAddSNMPCommunityString = 'public';
                    if (document.getElementById("AddSNMP").checked) {
                        szAddSNMP = "1";
                        szAddSNMPCommunityString = document.getElementById("AddSNMPCommunityString").value;
                    }

                    var x_value = document.getElementById("myDropdownAddIcon").style.left;
                    var y_value = document.getElementById("myDropdownAddIcon").style.top;
                    x_value = x_value.slice(0, -2);
                    y_value = y_value.slice(0, -2);
                    x_value = 100 * x_value / zoom_current;
                    y_value = 100 * y_value / zoom_current;
                    x_value = Math.floor(x_value);
                    y_value = Math.floor(y_value);
                    x_value = zeroPad(x_value, 5);
                    y_value = zeroPad(y_value, 5);
                    document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_icon_set?data=' + 1 + current_mac + zeroPad(canvas_width, 5) + zeroPad(canvas_height, 5) + x_value + y_value + szAddParentMAC + szAddParentPort + szAddLocalPort + szAddPingCheck + szAddSNMP + szAddIP + '|' + szAddProductName + '|' + szAddSystemName + '|' + tmp_img_name + '|' + szAddSNMPCommunityString + '&csrf_token=' + csrf_token;
                    //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_icon_set' + rd + 1 + current_mac + zeroPad(canvas_width, 5) + zeroPad(canvas_height, 5) + x_value + y_value + szAddParentMAC + szAddParentPort + szAddLocalPort + szAddPingCheck + szAddIP + '|' + szAddProductName + '|' + szAddSystemName + '|' + tmp_img_name + '&csrf_token=' + csrf_token;
                }
            }
        }
        else {
            document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_icon_set?data=' + 0 + current_mac + tmp_img_name + '&csrf_token=' + csrf_token;
            //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_icon_set' + rd + 0 + current_mac + tmp_img_name + '&csrf_token=' + csrf_token;

        }
    }

    function csrf_token_check() {
        document.topology_check.location.href = '/webctrl/Login/cgi_ems_csrf_token_check?csrf_token=' + csrf_token;
        //document.topology_check.location.href='webctrl.cgi?action=cgi_ems_csrf_token_check&csrf_token='+csrf_token;
        setTimeout("csrf_token_check()", 600000);
    }


    function mac17_to_mac12(mac) {
        var mac12 = mac.substring(0, 2) + mac.substring(3, 5) + mac.substring(6, 8) + mac.substring(9, 11) + mac.substring(12, 14) + mac.substring(15, 17);
        return mac12;
    }

    var remote_mac = "";

    function checkIPFormat(ip) {
        /*--check IP--*/
        if (ip.indexOf("255.255.255.255") == 0 || ip.indexOf("0.0.0.0") == 0) {
            alert("IP address error!");
            return false;
        }
        if (ip.search(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/) != -1) {
            var myArray = ip.split(/\./);
            if ((myArray[0] > 255) || (myArray[1] > 255) || (myArray[2] > 255) || (myArray[3] > 255) ||
                (myArray[0] < 0) || (myArray[1] < 0) || (myArray[2] < 0) || (myArray[3] < 0)) {
                alert("IP address error!");
                return false;
            }
            return true;
        } else {
            alert("IP address error!");
            return false;
        }
    }

    function remote_set_processing() {
        if ((document.getElementById("SetIP_submit") == null) ||
            (document.getElementById("Reboot_submit") == null) ||
            (document.getElementById("Save_submit") == null) ||
            (document.getElementById("FactoryDefault_submit") == null))
            return false;
        if ((document.getElementById("SetIP_submit").value == "Processing ...") ||
            (document.getElementById("Reboot_submit").value == "Processing ...") ||
            (document.getElementById("Save_submit").value == "Processing ...") ||
            (document.getElementById("FactoryDefault_submit").value == "Processing ..."))
            return true;
        else
            return false;
    }

    function deleteCookie(cname) {
        document.cookie = cname + "= ; expires = Thu, 01 Jan 1970 00:00:00 GMT"
    }

    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    /* For Color Information */
    var red_gradient_from = "#FF0000";
    var red_gradient_to = "#CC0000";
    var yellow_gradient_from = "#FFD800";
    var yellow_gradient_to = "#E2C000";
    var green_gradient_from = "#1CAF28";
    var green_gradient_to = "#269B30";

    /* For Edges Color */
    var edges_default_color = '#5FAD41'; // green
    var edges_green = '#5FAD41';
    var edges_yellow = '#FABF22';
    var edges_red = '#FF0000';
    var edges_blue = '#0000FF';
    var edges_font_color = '#150578';

    var alert_img_str = 'ems_images/alert.gif';
    var critical_img_str = 'ems_images/critical.gif';
    var empty_img_str = 'ems_images/empty.gif';

    var information_flag = 0;
    function hideMesseage() {
        document.getElementById("messeage_div").style = 'display:none;background-color:#C6D6DF;border-radius:20px;float:left;width:340px;height:200px;padding:0px;margin:0px;margin-top:75px;margin-left:10px;';
        information_flag = 0;
    }
    //setTimeout('hideMesseage()',10000);

    function fixZoom() {
        if (remote_set_processing())
            return;
        location.reload();
    }

    function DDMS() {

        //window.location.href = 'ddms.htm';
        if (rd == "rd") {
            window.open(
                'ddms.htm?r=0&csrf_token=' + csrf_token,
                '_blank' // <- This is what makes it open in a new window.
            );
        }
        else {
            window.open(
                'ddms.htm?r=2&csrf_token=' + csrf_token,
                '_blank' // <- This is what makes it open in a new window.
            );
        }


    }


    // ------------------------------------------------

    // 這個function就是會跳去設定背景的那頁
        
    function BG_Setting() {

        //window.location.href = 'bg_setting.htm';
        window.open(
            'bg_setting.htm?csrf_token=' + csrf_token,
            '_blank' // <- This is what makes it open in a new window.
        );
    }

    // ------------------------------------------------


    function SNMP() {

        //window.location.href = 'ddms.htm';
        if (rd == "rd") {
            window.open(
                'snmp.htm ? r = 0 & csrf_token=' + csrf_token,
                '_blank' // <- This is what makes it open in a new window.
            );
        }
        else {
            window.open(
                'snmp.htm?r=2&csrf_token=' + csrf_token,
                '_blank' // <- This is what makes it open in a new window.
            );
        }
    }


    // ------------------------------------------------


    // document.ready()=等DOM完成載入就執行的function
    // 不會等resource載入while body onload event會等

    $(document).ready(function () {
        //$('#bg_img').click(function() {
        //    window.location.href = 'https://www.volktek.com/';
        //});
        $('#dashboard').click(function () {
            if (remote_set_processing())
                return;
            window.location.href = 'index2.html';
        });
        $('#login').click(function () {
            if (remote_set_processing())
                return;
            window.location.href = 'login.htm';
        });
        $('#information').click(function () {
            if (information_flag == 0) {
                document.getElementById("messeage_div").style = 'display:block;background-color:#C6D6DF;border-radius:20px;float:left;width:340px;height:200px;padding:0px;margin:0px;margin-top:75px;margin-left:10px;';
                information_flag = 1;
            } else {
                document.getElementById("messeage_div").style = 'display:none;background-color:#C6D6DF;border-radius:20px;float:left;width:340px;height:200px;padding:0px;margin:0px;margin-top:75px;margin-left:10px;';
                information_flag = 0;
            }
        });
        InitFilterList() ;

    });


    // ------------------------------------------------


    // 喔喔 喔 喔喔喔喔 喔 喔   喔   喔    喔

    // TODO:搞懂這個
    // The ajax() method is used to perform an AJAX (asynchronous HTTP) request

    function InitFilterList() {
        let ajax_snmp = jQuery.ajax({
            url: '/webctrl/TopologyMap/GetMacList?csrf_token=' + csrf_token,
            type: 'POST',
            dataType: 'json'
        });


        jQuery.when(ajax_snmp)  // when裡面塞一個function(callback function)
            .done(function (result) {
                if (result) {
                    let json_result = JSON.parse(result);
                    if (json_result.success) {
                        let macList = json_result.data;
                        RenderFilterOption(macList);
                    }
                    else {
                        Alert('Filter List Initailize Failed!\n' + json_result.message);
                    }
                }
                else
                    Alert('Filter List Initailize No Response!');
            })
            .fail(function () {
                Alert('Filter List Initailize Failed!');
            });
    }


    // ------------------------------------------------


    function RenderFilterOption(source) {
        let objList = document.getElementById('device_ip_list');
        objList.options.length = 0;
        source.forEach(function (item) {
            var option = document.createElement('option');
            option.value = item;
            objList.appendChild(option);
        });

    }

    var xxx = 0;
    var yyy = 0;
    var result_message = "";


    function SubmitRemoteAction(action, mac) {
        if (remote_set_processing())
            return;
        if (action == "SetIP")//ipconfig
        {
            var username = document.getElementById(action + "_username").value;
            var password = document.getElementById(action + "_password").value;
            var ip = document.getElementById(action).value;
            if ((username == "") || (password == "") || (ip == "")) {
                alert("Error: User Name / Password / IP Addess cannot be empty.");
                return;
            }
            if (!checkIPFormat(ip))
                return;
            var usrpwd = sha256.hex(sha256.hex(password) + sha256.hex(username));
            result_message = "";
            if (!confirm('Do you really want to Set New IP to device ?(' + mac + ')'))
                return;
            document.getElementById(action + "_result").innerHTML = ""
            document.getElementById(action + "_submit").value = "Processing ...";
            //document.getElementById(action+"_submit").disabled=true;
            document.topology_set.location.href = '/webctrl/RemoteSet/cgi_ems_remote_set_map?data=' + '0100' + mac + usrpwd + ip + '&csrf_token=' + csrf_token;

        }
        if (action == "Reboot")//reboot
        {
            var username = document.getElementById(action + "_username").value;
            var password = document.getElementById(action + "_password").value;
            if ((username == "") || (password == "")) {
                alert("Error: User Name / Password cannot be empty.");
                return;
            }
            var usrpwd = sha256.hex(sha256.hex(password) + sha256.hex(username));
            result_message = "";
            if (!confirm('Do you really want to Reboot the device ? (' + mac + ')'))
                return;
            document.getElementById(action + "_result").innerHTML = ""
            document.getElementById(action + "_submit").value = "Processing ...";
            //document.getElementById(action+"_submit").disabled=true;
            //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_remote_set' + rd + '0200' + mac + usrpwd + '&csrf_token=' + csrf_token;
            document.topology_set.location.href = '/webctrl/RemoteSet/cgi_ems_remote_set_map?data=' + '0200' + mac + usrpwd + '&csrf_token=' + csrf_token;
        }
        if (action == "FactoryDefault")//factorydefault
        {
            var username = document.getElementById(action + "_username").value;
            var password = document.getElementById(action + "_password").value;
            if ((username == "") || (password == "")) {
                alert("Error: User Name / Password cannot be empty.");
                return;
            }
            var usrpwd = sha256.hex(sha256.hex(password) + sha256.hex(username));
            result_message = "";
            if (!confirm('Do you really want to Factory Default the device ? (' + mac + ')'))
                return;
            document.getElementById(action + "_result").innerHTML = ""
            document.getElementById(action + "_submit").value = "Processing ...";
            //document.getElementById(action+"_submit").disabled=true;
            //alert(csrf_token);
            //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_remote_set' + rd + '0300' + mac + usrpwd + '&csrf_token=' + csrf_token;
            document.topology_set.location.href = '/webctrl/RemoteSet/cgi_ems_remote_set_map?data=' + '0300' + mac + usrpwd + '&csrf_token=' + csrf_token;
        }
        if (action == "Save")//save
        {
            var username = document.getElementById(action + "_username").value;
            var password = document.getElementById(action + "_password").value;
            if ((username == "") || (password == "")) {
                alert("Error: User Name / Password cannot be empty.");
                return;
            }
            var usrpwd = sha256.hex(sha256.hex(password) + sha256.hex(username));
            result_message = "";
            if (!confirm('Do you really want to save the settings of device ? (' + mac + ')'))
                return;
            document.getElementById(action + "_result").innerHTML = ""
            document.getElementById(action + "_submit").value = "Processing ...";
            //document.getElementById(action+"_submit").disabled=true;
            //alert(csrf_token);
            document.topology_set.location.href = '/webctrl/RemoteSet/cgi_ems_remote_set_map?data=' + '0700' + mac + usrpwd + '&csrf_token=' + csrf_token;
        }
    }

    function mac12_to_mac17(mac) {
        if (mac == "1")
            mac = local_mac;
        var mac17 = mac.substring(0, 2) + ":" + mac.substring(2, 4) + ":" + mac.substring(4, 6) + ":" + mac.substring(6, 8) + ":" + mac.substring(8, 10) + ":" + mac.substring(10, 12);
        return mac17;
    }

    function remote_device_action(id, action, mac) {
        if (remote_set_processing())
            return;
        if (action != "05")//add_icon
            remote_mac = mac12_to_mac17(mac);
        document.getElementById("set_ip").style = 'background-color:#0d0d0d;';
        document.getElementById("reboot").style = 'background-color:#0d0d0d;';
        document.getElementById("factory_default").style = 'background-color:#0d0d0d;';
        document.getElementById("save").style = 'background-color:#0d0d0d;';
        document.getElementById("change_icon").style = 'background-color:#0d0d0d;';
        document.getElementById("add_icon").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp").style = 'background-color:#0d0d0d;';
        document.getElementById("edit_icon").style = 'background-color:#0d0d0d;';
        document.getElementById("delete_icon").style = 'background-color:#0d0d0d;';
        document.getElementById("set_ip").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("set_ip").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("reboot").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("reboot").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("factory_default").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("factory_default").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("save").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("save").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("change_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("change_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("add_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("add_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("delete_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("delete_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("edit_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("edit_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }

        /*********************SNMP new features*****************/
        document.getElementById("snmp_information").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_information").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_information").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_dashboard").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_dashboard").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_dashboard").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_settings").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_settings").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_settings").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_monitoring").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_monitoring").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_monitoring").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_system_contact").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_system_contact").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_system_contact").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_system_name").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_system_name").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_system_name").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_location").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_location").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_location").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
        document.getElementById("snmp_other_oid").style = 'background-color:#0d0d0d;';
        document.getElementById("snmp_other_oid").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
        document.getElementById("snmp_other_oid").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }

        if ((action != "12") && (action != "13"))//Not submit_icon && Not submit_edge
        {
            document.getElementById(id).style = 'background-color:#56616A;';
            document.getElementById(id).onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById(id).onmouseout = function () { this.style.backgroundColor = "#56616A"; }
        }
        document.getElementById("myDropdownSetIP").style.display = "none";
        document.getElementById("myDropdownReboot").style.display = "none";
        document.getElementById("myDropdownFactoryDefault").style.display = "none";
        document.getElementById("myDropdownSave").style.display = "none";
        document.getElementById("myDropdownChangeIcon").style.display = "none";
        document.getElementById("myDropdownLiteManagementSet").style.display = "none";
        document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
        document.getElementById("myDropdownSelectIcon").style.display = "none";
        document.getElementById("myDropdownSNMP").style.display = "none";
        document.getElementById("myDropdownRemoteSetting").style.display = "none";
        document.getElementById("myDropdownEditIcon").style.display = "none";
        document.getElementById("myDropdownMoveEdge").style.display = "none";
        document.getElementById("myDropdownAddIcon").style.display = "none";

        switch (action) {
            case "01": //ipconfig
                document.getElementById("myDropdownSetIP").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownSetIP").style.top = yyy + "px";
                document.getElementById("SetIP_username").value = "";
                document.getElementById("SetIP_password").value = "";
                document.getElementById("SetIP").value = "";
                document.getElementById("SetIP_result").innerHTML = "";
                if (document.getElementById("SetIP_submit").value != "Processing ...") {
                    document.getElementById("SetIP_submit").value = "Submit"
                    document.getElementById("SetIP_submit").disabled = false;
                }
                document.getElementById("myDropdownSetIP").style.display = "block";
                break;
            case "02": //reboot
                document.getElementById("myDropdownReboot").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownReboot").style.top = yyy + "px";
                document.getElementById("Reboot_username").value = "";
                document.getElementById("Reboot_password").value = "";
                document.getElementById("Reboot_result").innerHTML = "";
                if (document.getElementById("Reboot_submit").value != "Processing ...") {
                    document.getElementById("Reboot_submit").value = "Submit"
                    document.getElementById("Reboot_submit").disabled = false;
                }
                document.getElementById("myDropdownReboot").style.display = "block";
                break;
            case "03": //factorydefault
                document.getElementById("myDropdownFactoryDefault").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownFactoryDefault").style.top = yyy + "px";
                document.getElementById("FactoryDefault_username").value = "";
                document.getElementById("FactoryDefault_password").value = "";
                document.getElementById("FactoryDefault_result").innerHTML = "";
                if (document.getElementById("FactoryDefault_submit").value != "Processing ...") {
                    document.getElementById("FactoryDefault_submit").value = "Submit"
                    document.getElementById("FactoryDefault_submit").disabled = false;
                }
                document.getElementById("myDropdownFactoryDefault").style.display = "block";
                break;
            case "04": //changeicon
                document.getElementById("myDropdownChangeIcon").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownChangeIcon").style.top = yyy + "px";
                current_img_name = current_img.replace("ems_images/", "");
                current_img_name = current_img_name.replace(".gif", "");
                current_img_name = current_img_name.replace(".png", "");
                current_img_name = current_img_name.replace("-unknown", "");
                current_img_index = 0;
                document.getElementById("icon_name").innerHTML = "[" + current_img_name + "]";
                document.getElementById("icon_img").src = current_img;
                document.getElementById("myDropdownChangeIcon").style.display = "block";
                current_select_img = current_img;
                break;
            case "05": //add_icon
                current_img = "ems_images/generic-unknown.gif";
                document.getElementById("myDropdownSelectIcon").style.left = (xxx + 200) + "px";
                document.getElementById("myDropdownSelectIcon").style.top = yyy + "px";
                current_img_name = current_img.replace("ems_images/", "");
                current_img_name = current_img_name.replace(".gif", "");
                current_img_name = current_img_name.replace(".png", "");
                current_img_name = current_img_name.replace("-unknown", "");
                current_img_index = 0;
                document.getElementById("add_icon_name").innerHTML = "[" + current_img_name + "]";
                document.getElementById("add_icon_img").src = current_img;
                document.getElementById("myDropdownSelectIcon").style.display = "block";
                current_select_img = current_img;
                break;
            case "06": //fix position
                var positions = network.getPositions(mac);
                var x_value = positions[mac].x + (canvas_width / 2);
                var y_value = positions[mac].y + (canvas_height / 2);
                x_value = zeroPad(x_value, 5);
                y_value = zeroPad(y_value, 5);
                //console.log(mac+" "+x_value+" "+y_value);
                document.getElementById("myDropdownManualIcon").style.display = "none";
                break;
            case "07": //save
                document.getElementById("myDropdownSave").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownSave").style.top = yyy + "px";
                document.getElementById("Save_username").value = "";
                document.getElementById("Save_password").value = "";
                document.getElementById("Save_result").innerHTML = "";
                if (document.getElementById("Save_submit").value != "Processing ...") {
                    document.getElementById("Save_submit").value = "Submit"
                    document.getElementById("Save_submit").disabled = false;
                }
                document.getElementById("myDropdownSave").style.display = "block";
                break;
            case "08": //Lite Management
                document.getElementById("myDropdownLiteManagementSet").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownLiteManagementSet").style.top = yyy + "px";
                document.getElementById("myDropdownLiteManagementSet").style.display = "block";
                break;
            case "09": //Lite Management PoE
                document.getElementById("myDropdownLiteManagementSet_PoE").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownLiteManagementSet_PoE").style.top = yyy + "px";
                document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "block";
                break;
            case "10": //delete_icon
                if (!confirm('Do you really want to delete this device ?(' + mac12_to_mac17(mac) + ')')) {
                    document.getElementById("myDropdownManualIcon").style.display = "none";
                    return;
                }
                document.getElementById("myDropdownManualIcon").style.display = "none";
                document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_icon_set?data=' + 3 + mac + '&csrf_token=' + csrf_token;
                break;
            case "11": //edit_icon
                var found = 0;
                var j = manual_neighbor_mac.indexOf(mac);
                if (j >= 0) {
                    found = 1;
                }
                if (found) {
                    document.getElementById("EditIP").value = manual_neighbor_ip[j];
                    document.getElementById("EditProductName").value = manual_neighbor_product_name[j];
                    document.getElementById("EditSystemName").value = manual_neighbor_system_name[j];
                    if (manual_neighbor_parent_id[j] == "1")
                        document.getElementById("EditParentMAC").value = mac12_to_mac17(local_mac);
                    else
                        document.getElementById("EditParentMAC").value = mac12_to_mac17(manual_neighbor_parent_id[j]);
                    document.getElementById("EditParentPort").value = manual_neighbor_with_host_port[j];
                    document.getElementById("EditLocalPort").value = manual_neighbor_local_port[j];
                    if (manual_neighbor_ping_check[j] != "0.0.0.0")
                        document.getElementById("EditPingCheck").checked = true;
                    if (manual_neighbor_snmp_flag[j] != 0) {
                        document.getElementById("EditSNMP").checked = true;
                        document.getElementById("EditSNMPCommunityString").style.display = 'inline-block';
                        document.getElementById("EditSNMPCommunityString").value = manual_neighbor_snmp_community_string[j];
                    }
                }
                document.getElementById("EditMAC").value = remote_mac;
                document.getElementById("myDropdownEditIcon").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownEditIcon").style.top = yyy + "px";
                document.getElementById("myDropdownEditIcon").style.display = "block";
                break;
            case "12": //submit_icon
                if ((document.getElementById("EditIP").value != "") && (!checkIPFormat(document.getElementById("EditIP").value))) {
                    return false;
                }
                if (checkMACFormat(document.getElementById('EditMAC').value))
                    current_mac = mac17_to_mac12(document.getElementById('EditMAC').value)
                else {
                    alert("MAC address error!");
                    return false;
                }
                if (document.getElementById("EditProductName").value == "") {
                    alert("Product Name cannot be empty!");
                    return false;
                }
                if (document.getElementById("EditSystemName").value == "") {
                    alert("System Name cannot be empty!");
                    return false;
                }
                if ((document.getElementById("EditParentMAC").value != "00:00:00:00:00:00") && (!checkMACFormat(document.getElementById("EditParentMAC").value))) {
                    alert("Parent MAC address error!");
                    return false;
                }
                if ((document.getElementById("EditParentPort").value == "") || (isNaN(parseInt(document.getElementById("EditParentPort").value, 10)))) {
                    alert("Parent Port error!");
                    return false;
                }
                if ((document.getElementById("EditLocalPort").value == "") || (isNaN(parseInt(document.getElementById("EditLocalPort").value, 10)))) {
                    alert("Local Port error!");
                    return false;
                }
                if ((document.getElementById("EditLocalPort").value == "") || (isNaN(parseInt(document.getElementById("EditLocalPort").value, 10)))) {
                    alert("Local Port error!");
                    return false;
                }
                if (document.getElementById("EditSNMP").checked && document.getElementById("EditSNMPCommunityString").value == "") {
                    alert("SNMP Community String cannot be empty!");
                    return false;
                }
                var szAddIP = document.getElementById("EditIP").value;
                if (szAddIP == "")
                    szAddIP = "0.0.0.0";
                var szAddProductName = str2hex(document.getElementById("EditProductName").value);
                var szAddSystemName = str2hex(document.getElementById("EditSystemName").value);
                var szAddParentMAC = mac17_to_mac12(document.getElementById("EditParentMAC").value);
                szAddParentMAC = szAddParentMAC.toLowerCase();
                if (szAddParentMAC == local_mac)
                    szAddParentMAC = "000000000000";
                var szAddParentPort = zeroPad(document.getElementById("EditParentPort").value, 2);
                var szAddLocalPort = zeroPad(document.getElementById("EditLocalPort").value, 2);
                var szAddPingCheck = "0";
                if (document.getElementById("EditPingCheck").checked)
                    szAddPingCheck = "1";
                var szAddSNMP = "0";
                var szAddSNMPCommunityString = "public";
                if (document.getElementById("EditSNMP").checked) {
                    szAddSNMP = "1";
                    document.getElementById("EditSNMPCommunityString").style.display = 'inline-block';
                    szAddSNMPCommunityString = document.getElementById("EditSNMPCommunityString").value;
                }
                document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_icon_set?data=' + 4 + current_mac + szAddParentMAC + szAddParentPort + szAddLocalPort + szAddPingCheck + szAddSNMP + szAddIP + '|' + szAddProductName + '|' + szAddSystemName + '|' + szAddSNMPCommunityString + '&csrf_token=' + csrf_token;

                break;
            case "13": //submit_edge
                var szMoveMAC = mac17_to_mac12(remote_mac)
                var szMoveParentMAC = mac17_to_mac12(document.getElementById("MoveParentMAC").value)
                if (szMoveParentMAC == local_mac)
                    szMoveParentMAC = "000000000000";
                else {
                    var found = 0;
                    szMoveParentMAC = szMoveParentMAC.toLowerCase();
                    if (!found) {
                        if (neighbor_mac.indexOf(szMoveParentMAC) >= 0)
                            found = 1;
                    }
                    if (!found) {
                        if (manual_neighbor_mac.indexOf(szMoveParentMAC) >= 0)
                            found = 1;
                    }
                    if (!found) {
                        if (lock_state) {
                            if (lock_neighbor_mac.indexOf(szMoveParentMAC) >= 0)
                                found = 1;
                        }
                    }
                    if (!found) {
                        alert("Error: This MAC address has not existed in Map.");
                        return;
                    }
                }
                var szMoveParentPort = zeroPad(document.getElementById("MoveParentPort").value, 2);
                var szMoveLocalPort = zeroPad(document.getElementById("MoveLocalPort").value, 2);
                document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_icon_set?data=' + 5 + szMoveMAC + szMoveParentMAC.toLowerCase() + szMoveParentPort + szMoveLocalPort + '&csrf_token=' + csrf_token;
                break;
            case "14": //reset_edge
                var szMoveMAC = mac17_to_mac12(remote_mac)
                var szMoveParentMAC = mac17_to_mac12(document.getElementById("MoveParentMAC").value)
                document.getElementById("myDropdownMoveEdge").style.display = "none";
                document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_icon_set?data=' + 6 + szMoveMAC + '&csrf_token=' + csrf_token;
                break;
            case "15": //snmp menu
                document.getElementById("myDropdownSNMP").style.left = (xxx + 150) + "px";
                document.getElementById("myDropdownSNMP").style.top = (yyy) + "px";
                document.getElementById("myDropdownSNMP").style.display = "block";
                break;
            case "16": //snmp information
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_information(neighbor_ip[j]);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_information(manual_neighbor_ip[j]);
                    }
                    else {
                        alert("Error: No SNMP information due to no IP.");
                    }
                }
                break;
            case "17": //snmp dashboard
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_dashboard(neighbor_ip[j], csrf_token);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_dashboard(manual_neighbor_ip[j], csrf_token);
                    }
                    else {
                        alert("Error: No SNMP Dashboard due to no IP.");
                    }
                }
                break;
            case "18": //snmp settings menu
                document.getElementById("myDropdownSNMP").style.display = "block";
                document.getElementById("myDropdownRemoteSetting").style.left = (xxx + 300) + "px";
                document.getElementById("myDropdownRemoteSetting").style.top = (yyy) + "px";
                document.getElementById("myDropdownRemoteSetting").style.display = "block";
                break;
            case "19": //snmp monitoring
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_monitoring(neighbor_ip[j]);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_monitoring(manual_neighbor_ip[j]);
                    }
                    else {
                        alert("Error: No SNMP monitoring due to no IP.");
                    }
                }
                break;
            case "20": //remote set system_contact
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_remote_set(neighbor_ip[j], 1);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_remote_set(manual_neighbor_ip[j], 1);
                    }
                    else {
                        alert("Error: No SNMP Remote Set (System Contact) due to no IP.");
                    }
                }
                break;
            case "21":  //remote set system_name
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_remote_set(neighbor_ip[j], 2);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_remote_set(manual_neighbor_ip[j], 2);
                    }
                    else {
                        alert("Error: No SNMP Remote Set (System Name) due to no IP.");
                    }
                }
                break;
            case "22": //remote set location
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_remote_set(neighbor_ip[j], 3);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_remote_set(manual_neighbor_ip[j], 3);
                    }
                    else {
                        alert("Error: No SNMP Remote Set (Location) due to no IP.");
                    }
                }
                break;
            case "23": //remote set other oid
                var j = neighbor_mac.indexOf(mac);
                if (j >= 0) {   //auto discovery node
                    click_snmp_remote_set(neighbor_ip[j], 4);
                }
                else {  //manual node
                    j = manual_neighbor_mac.indexOf(mac);
                    if (j >= 0) {
                        click_snmp_remote_set(manual_neighbor_ip[j], 4);
                    }
                    else {
                        alert("Error: No SNMP Remote Set (Other OID) due to no IP.");
                    }
                }
                break;
        }

    }

    var bg_width = 0;
    var bg_height = 0;
    var org_width = 0;
    var org_height = 0;
    var zoom_current = 100;
    var cookie_zoom_current = getCookie('zoom_current');
    if ((cookie_zoom_current == "") || (cookie_zoom_current == "NaN"))
        setCookie('zoom_current', '100', 365);
    else
        zoom_current = cookie_zoom_current;
    var selectindex_bg_opacity_current = "0";
    var cookie_selectindex_bg_opacity = getCookie('selectindex_bg_opacity');
    if ((cookie_selectindex_bg_opacity == "") || (cookie_selectindex_bg_opacity == "NaN"))
        setCookie('selectindex_bg_opacity', '0', 365);
    else
        selectindex_bg_opacity_current = cookie_selectindex_bg_opacity;

    function location_reload() {
        if (document.visibilityState != "visible")
            setTimeout('location_reload()', 100);
        else
            location.reload();
    }

    function zoom_in() {
        document.getElementById("myDropdownSetIP").style.display = "none";
        document.getElementById("myDropdownReboot").style.display = "none";
        document.getElementById("myDropdownFactoryDefault").style.display = "none";
        document.getElementById("myDropdownSave").style.display = "none";
        document.getElementById("myDropdownChangeIcon").style.display = "none";
        document.getElementById("myDropdown").style.display = "none";
        document.getElementById("myDropdownLiteManagementSet").style.display = "none";
        document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
        document.getElementById("myDropdownLiteManagement").style.display = "none";
        document.getElementById("myDropdownLiteManagement_PoE").style.display = "none";
        document.getElementById("myDropdownLiteManagementOnly").style.display = "none";
        document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "none";
        document.getElementById("myDropdownAddIcon").style.display = "none";
        document.getElementById("myDropdownEditIcon").style.display = "none";
        document.getElementById("myDropdownMoveEdge").style.display = "none";
        document.getElementById("myDropdownSelectIcon").style.display = "none";
        document.getElementById("myDropdownSNMP").style.display = "none";
        document.getElementById("myDropdownRemoteSetting").style.display = "none";
        if (zoom_current < 100)
            zoom_current = zoom_current + 10;
        document.getElementById("mynetwork").style.width = org_width * zoom_current / 100;
        document.getElementById("mynetwork").style.height = org_height * zoom_current / 100;
        document.getElementById("size_scale").value = "" + zoom_current + "% of " + org_width + "x" + org_height;
        document.getElementById("bg_img").width = bg_width * zoom_current / 100;
        document.getElementById("bg_img").height = bg_height * zoom_current / 100;
        //document.getElementById("mynetwork").style.backgroundColor="#EEEEEE";
        //document.getElementById("bg_img").src="images/login_layer_bg.gif";
        setCookie('zoom_current', zoom_current, 365);
    }

    function zoom_out() {
        document.getElementById("myDropdownSetIP").style.display = "none";
        document.getElementById("myDropdownReboot").style.display = "none";
        document.getElementById("myDropdownFactoryDefault").style.display = "none";
        document.getElementById("myDropdownSave").style.display = "none";
        document.getElementById("myDropdownChangeIcon").style.display = "none";
        document.getElementById("myDropdown").style.display = "none";
        document.getElementById("myDropdownLiteManagementSet").style.display = "none";
        document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
        document.getElementById("myDropdownLiteManagement").style.display = "none";
        document.getElementById("myDropdownLiteManagement_PoE").style.display = "none";
        document.getElementById("myDropdownLiteManagementOnly").style.display = "none";
        document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "none";
        document.getElementById("myDropdownAddIcon").style.display = "none";
        document.getElementById("myDropdownEditIcon").style.display = "none";
        document.getElementById("myDropdownMoveEdge").style.display = "none";
        document.getElementById("myDropdownSelectIcon").style.display = "none";
        document.getElementById("myDropdownSNMP").style.display = "none";
        document.getElementById("myDropdownRemoteSetting").style.display = "none";
        if (zoom_current > 30)
            zoom_current = zoom_current - 10;
        document.getElementById("mynetwork").style.width = org_width * zoom_current / 100;
        document.getElementById("mynetwork").style.height = org_height * zoom_current / 100;
        document.getElementById("size_scale").value = "" + zoom_current + "% of " + org_width + "x" + org_height;
        document.getElementById("bg_img").width = bg_width * zoom_current / 100;
        document.getElementById("bg_img").height = bg_height * zoom_current / 100;
        //document.getElementById("mynetwork").style.backgroundColor="#AAAAAA";
        //document.getElementById("bg_img").src="images/technical_support.png";
        setCookie('zoom_current', zoom_current, 365);
    }

    function on_select_bg_opacity(f) {
        document.getElementById("bg_img").style.opacity = f.value;
        setCookie('selectindex_bg_opacity', f.selectedIndex, 365);
    }
</script>

<body id="table_body" style="background-position:50% 100px;background-repeat:no-repeat;">

    <div class="loader" id="div_loader" style="display:none"></div>
    <div id="dialogoverlay"></div>
    <!-- This disables and provides white overlay until user interacts with the dialog window -->
    <div id="dialogbox">
        <div>
            <div id="dialogboxhead"></div>
            <div id="dialogboxbody"></div>
            <div id="dialogboxfoot"></div>
        </div>
    </div>

    <div>
        <div style="float:left;margin-top:10px;margin-left:10px;">
            <select id="select_discovery" onchange="if(value=='SNMP'){init_discovery();}selectedIndex=0; " size=1>
                <option selected hidden disabled value="">Discovery</option>
                <option value="SNMP">SNMP</option>
            </select>
        </div>

        <div style="float:left;margin-top:10px;margin-left:10px;">
            <select id="select_advance"
                onchange="if(value=='DDMS'){DDMS();}else if(value=='SNMP'){SNMP();}else if(value=='CloseAll'){close_snmp_dashboard();}selectedIndex=0; "
                size=1>
                <option selected hidden disabled value="">Advance</option>
                <option value="DDMS">DDMS</option>
                <option value="SNMP">SNMP</option>
                <option value="CloseAll">Close Dashboard</option>
            </select>
        </div>

        <div style="float:left;margin-top:10px;margin-left:10px;">
            <select id="select_style"
                onchange="if(value=='Style_STAR'){set_edges_style(0);}else if(value=='Style_LEVEL'){set_edges_style(1);}selectedIndex=0; "
                size=1>
                <option selected hidden disabled value="">Style</option>
                <option value="Style_STAR" disabled>Style-STAR</option>
                <option value="Style_LEVEL" disabled>Style-LEVEL</option>
            </select>
        </div>

        <div style='float:left;margin-top:10px;margin-left:10px;'>
            <!-- <input id="show_label_btn" type="button" onclick="show_label();" value="Show Label" disabled> -->
            <input type="checkbox" id="show_label_btn" onclick="show_label();">
            <label for="show_label_btn"
                style='font-size:12px;font-family:Microsoft JhengHei;margin-left:0px;margin-left:0px;vertical-align:2px;'>Label</label>
        </div>
        <div style='float:left;margin-top:10px;margin-left:10px;'>
            <input type="checkbox" id="show_edges_btn" checked
                onclick="if (edges_state) edges_state=0; else edges_state=1; show_edges();">
            <label for="show_edges_btn"
                style='font-size:12px;font-family:Microsoft JhengHei;margin-left:0px;margin-left:0px;vertical-align:2px;'>Edge</label>
        </div>

        <div style="float:left;margin-top:5px;margin-left:10px;">
            <input id="Reload_Page" type="image" src="images/reload.png" onclick="fixZoom();" title="Reload Page"
                width="23" height="23" disabled>
        </div>

        <!-- 設定background的button在這 onclick event -->

        <div style="float:left;margin-top:5px;margin-left:10px;">
            <input id="Background" type="image" src="images/upload.png" title="Upload Background & Icon"
                onclick="BG_Setting();" width="27" height="24">
        </div>

        <div style='float:left;margin-top:5px;margin-left:10px;'>
            <!-- <input id="Lock_Map" type="button" onclick="save_positions();" value="Lock Map" disabled> -->
            <input id="Lock_Map" type="image" src="images/lock.png" onclick="save_positions();" width="24" height="24"
                title="Lock Map" disabled>
        </div>
        <div style='float:left;margin-top:6px;margin-left:10px;'>
            <!-- <input id="Unlock_Map" type="button" onclick="unlock_positions();" value="Unlock Map" disabled> -->
            <input id="Unlock_Map" type="image" src="images/unlock.png" onclick="unlock_positions();" width="23"
                height="23" title="Unlock Topology Map" disabled>
        </div>
        <div style="float:left;margin-top:5px;margin-left:10px;">
            <!-- <input id="Zoom_In" type="button" onclick="zoom_in();" value="Zoom In" disabled> -->
            <input id="Zoom_In" type="image" src="images/zoom_in.png" onclick="zoom_in();" width="23" height="23"
                title="Zoom In" disabled>
        </div>
        <div style="float:left;margin-top:5px;margin-left:10px;">
            <!-- <input id="Zoom_Out" type="button" onclick="zoom_out();" value="Zoom Out" disabled> -->
            <input id="Zoom_Out" type="image" src="images/zoom_out.png" onclick="zoom_out();" width="23" height="23"
                title="Zoom Out" disabled>
        </div>
        <div style="float:left;margin-top:10px;margin-left:10px;">
            <input id="size_scale" type="text" value="" size=15 disabled>
        </div>
        <div style="float:left;margin-top:10px;margin-left:10px;">
            <select id="select_bg_opacity" onchange="on_select_bg_opacity(this)" size=1>
                <option value="1.0" selected>Background Opacity 100%</option>
                <option value="0.9">Background Opacity 90%</option>
                <option value="0.8">Background Opacity 80%</option>
                <option value="0.7">Background Opacity 70%</option>
                <option value="0.6">Background Opacity 60%</option>
                <option value="0.5">Background Opacity 50%</option>
                <option value="0.4">Background Opacity 40%</option>
                <option value="0.3">Background Opacity 30%</option>
                <option value="0.2">Background Opacity 20%</option>
                <option value="0.1">Background Opacity 10%</option>
                <option value="0.0">Background Opacity 0%</option>
            </select>
        </div>
    </div>


    <div style="position: absolute;top:60px;margin-left:0px;margin-top:0px;padding:0px;" />
    <img id="bg_img" src="images/empty.png" style="opacity:1;">
    </div>
    <div id="frame_icon"
        style="border-radius:0px 10px 10px 0px;width:70px;height:270px;margin-top:60px;z-index:99999999999999;position:absolute;">
        <script>
            //if (rd=="rd")
            //	document.write("<div style='float:left;width:50px;margin-top:10px;margin-left:10px;'>");
            //else
            document.write("<div style='display:none;float:left;width:50px;margin-top:10px;margin-left:10px;'>");
        </script>
        <img id="dashboard" src="images/dashboard_link.svg"
            style="width:50px;height:50px;margin-right:0px;margin-top:0px;" />
        <label
            style='font-size:10px;font-family:Microsoft JhengHei;margin-left:-5px;margin-left:-5px;vertical-align:10px;'>Dashboard</label>
    </div>
    <script>
        //if (rd=="rd")
        //	document.write("<div style='float:left;width:50px;margin-top:10px;margin-left:10px;'>");
        //else
        document.write("<div style='display:none;float:left;width:50px;margin-top:10px;margin-left:10px;'>");
    </script>
    <img id="login" src="images/login_2.svg" style="width:50px;height:50px;margin-right:0px;margin-top:0px;" />
    <label style='font-size:10px;font-family:Microsoft JhengHei;margin-left:10px;vertical-align:10px;'>Login</label>
    </div>
    <script>
        //if (rd=="rd")
        //	document.write("<div style='float:left;width:50px;margin-top:10px;margin-left:10px;'>");
        //else
        document.write("<div style='display:none;float:left;width:50px;margin-top:10px;margin-left:10px;'>");
    </script>
    <img id="information" src="images/prompt_messeage.svg"
        style="width:50px;height:50px;margin-right:0px;margin-top:0px;" />
    <label
        style='font-size:10px;font-family:Microsoft JhengHei;margin-left:-7px;vertical-align:10px;'>Information</label>
    </div>

    <!--
       <div style="float:left;width:50px;margin-top:10px;margin-left:10px;">
           <select id="select_cid">
           <script>
           for (cluster_port = 0; cluster_port < learning_port_configuration_state.length; cluster_port++)
               document.write("<option value="+(cluster_port+1)+">Port "+(cluster_port+1)+"</option>");
           </script>
           </select>
       </div>
       <div style="float:left;width:50px;margin-top:10px;margin-left:10px;">
           <input type="button" onclick="clusterByCid();" value="Show Port Group">
       </div>
       -->

    
    <!-- -------------------------------------------------->

    <!-- iframe連發 顆-->

    <div style="float:left;margin-top:10px;margin-left:10px;display:none;">
        <iframe name=topology_set id=topology_set src="" width=0 height=0 frameborder=0 scrolling=no></iframe>
        <iframe name=topology_check id=topology_check src="" width=0 height=0 frameborder=0 scrolling=no></iframe>
        <iframe name=topology_lock id=topology_lock src="" width=0 height=0 frameborder=0 scrolling=no></iframe>
        <iframe name=topology_update id=topology_update src="" width=0 height=0 frameborder=0 scrolling=no></iframe>
        <iframe name=lldp_init_neighbor id=lldp_init_neighbor src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_lock_neighbor id=lldp_lock_neighbor src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_lock_neighbor_xy id=lldp_lock_neighbor_xy src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_new_neighbor id=lldp_new_neighbor src="" width=0 height=0 frameborder=0 scrolling=no></iframe>
        <iframe name=lldp_init_topology id=lldp_init_topology src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_ems_images id=lldp_ems_images src="" width=0 height=0 frameborder=0 scrolling=no></iframe>
        <iframe name=lldp_manual_neighbor id=lldp_manual_neighbor src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_manual_neighbor_xy id=lldp_manual_neighbor_xy src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_manual_neighbor_ping id=lldp_manual_neighbor_ping src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
        <iframe name=lldp_move_neighbor id=lldp_move_neighbor src="" width=0 height=0 frameborder=0
            scrolling=no></iframe>
    </div>

    <!-- -------------------------------------------------->



    </div>



    <script>
        var w = window.innerWidth - 75;
        document.getElementById("frame_icon").style.marginLeft = w.toString() + 'px';
    </script>




    <div id="messeage_div"
        style="display:none;background-color:#C6D6DF;border-radius:20px;float:left;width:340px;height:200px;padding:0px;margin:0px;margin-top:75px;margin-left:10px;">
        <div id="frame_info"
            style="border-radius:20px;float:left;width:100%;height:40px;padding:0px;margin:0px;margin-top:0px;margin-left:0px;vertical-align:top;">
            <div id="frame_info_red" style="width:20px;height:20px;margin-left:15px;margin-top:20px;"></div>
            <lable
                style="text-align:left;margin-top:0px;font-size:12px;color:#000000;vertical-align:10%;font-weight:bold;">
                &nbsp;Critical&nbsp;&nbsp;&nbsp;&nbsp;</lable>
            <div id="frame_info_yellow" style="width:20px;height:20px;margin-left:15px;margin-top:10px;"></div>
            <lable
                style="text-align:left;margin-top:0px;font-size:12px;color:#000000;vertical-align:10%;font-weight:bold;">
                &nbsp;Alert&nbsp;&nbsp;&nbsp;&nbsp;</lable>
            <div id="frame_info_green" style="width:20px;height:20px;margin-left:15px;margin-top:10px;"></div>
            <lable
                style="text-align:left;margin-top:0px;font-size:12px;color:#000000;vertical-align:10%;font-weight:bold;">
                &nbsp;Normal&nbsp;&nbsp;&nbsp;&nbsp;</lable>
            <script>
                var frame_tmp = document.getElementById("frame_info_red");
                frame_tmp.style.background = "linear-gradient(to bottom, " + red_gradient_from + " 0%, " + red_gradient_to + " 100%)";
                frame_tmp = document.getElementById("frame_info_green");
                frame_tmp.style.background = "linear-gradient(to bottom, " + green_gradient_from + " 0%, " + green_gradient_to + " 100%)";
                frame_tmp = document.getElementById("frame_info_yellow");
                frame_tmp.style.background = "linear-gradient(to bottom, " + yellow_gradient_from + " 0%, " + yellow_gradient_to + " 100%)";
            </script>
        </div>
        <div style="float:left;width:100%;">
            <img id="double_click_img" src="images/bookmark.svg"
                style="float:left;width:28.8px;height:49.5px;margin-left:10px;margin-top:10px;padding:10px;" />
            <p style="color:#000000;margin-top:37px;"><b style="font-size:12px;">Press Ctrl+D to bookmark this page.</b>
            </p>
        </div>
        <div style="float:left;width:100%;">
            <img id="double_click_img" src="images/click.svg"
                style="float:left;width:28.8px;height:49.5px;margin-left:10px;margin-top:5px;padding:10px;" />
            <p style="color:#000000;margin-top:30px;"><b style="font-size:12px;">Double click the switch to
                    dashboard.</b></p>
        </div>
    </div>


    <div style="width: 500px;">
        <label style="float:left;margin-top:5px;margin-left:10px;font-size:12px;font-family:Microsoft JhengHei;">Search:
            <input list="device_ip_list" id="input_filter_device" name="input_filter_device" style="margin-left:4px"
                onchange="filter_device(this);" /></label>
        <datalist id="device_ip_list">
        </datalist>
        <input id="input_clear_filter" type="image" src="images/clear_filter.png" onclick="clear_filter();" width="23"
            height="23" title="Clear Filter" style="float:left;margin-top:3px;margin-left:10px;">
    </div>
    <div id="wrapper">
        <div id="mynetwork"></div>
    </div>
    <div id="myDropdown" class="dropdown-content">
        <a id=set_ip name=set_ip href="javascript: remote_device_action('set_ip', '01', mac_right_click);">IP
            Settings</a>
        <a id=reboot name=reboot href="javascript: remote_device_action('reboot', '02', mac_right_click);">Reboot</a>
        <a id=factory_default name=factory_default
            href="javascript: remote_device_action('factory_default', '03', mac_right_click);">Factory Default</a>
        <a id=save name=save href="javascript: remote_device_action('save', '07', mac_right_click);">Save</a>
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <div id="myDropdownLiteManagement" class="dropdown-content">
        <a id=lite_management name=lite_management
            href="javascript: remote_device_action('lite_management', '08', mac_right_click);">Lite Management</a>
        <a id=set_ip name=set_ip href="javascript: remote_device_action('set_ip', '01', mac_right_click);">IP
            Settings</a>
        <a id=reboot name=reboot href="javascript: remote_device_action('reboot', '02', mac_right_click);">Reboot</a>
        <a id=factory_default name=factory_default
            href="javascript: remote_device_action('factory_default', '03', mac_right_click);">Factory Default</a>
        <a id=save name=save href="javascript: remote_device_action('save', '07', mac_right_click);">Save</a>
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <div id="myDropdownLiteManagement_PoE" class="dropdown-content">
        <a id=lite_management_poe name=lite_management_poe
            href="javascript: remote_device_action('lite_management_poe', '09', mac_right_click);">Lite Management</a>
        <a id=set_ip name=set_ip href="javascript: remote_device_action('set_ip', '01', mac_right_click);">IP
            Settings</a>
        <a id=reboot name=reboot href="javascript: remote_device_action('reboot', '02', mac_right_click);">Reboot</a>
        <a id=factory_default name=factory_default
            href="javascript: remote_device_action('factory_default', '03', mac_right_click);">Factory Default</a>
        <a id=save name=save href="javascript: remote_device_action('save', '07', mac_right_click);">Save</a>
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <div id="myDropdownLiteManagementOnly" class="dropdown-content">
        <a id=lite_management_only name=lite_management_only
            href="javascript: remote_device_action('lite_management_only', '08', mac_right_click);">Lite Management</a>
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <div id="myDropdownLiteManagementOnly_PoE" class="dropdown-content">
        <a id=lite_management_only_poe name=lite_management_only_poe
            href="javascript: remote_device_action('lite_management_only_poe', '09', mac_right_click);">Lite
            Management</a>
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <!--show_page_reg 都是舊的LLDP，不做-->
    <div id="myDropdownLiteManagementSet" class="dropdown-content">
        <a href='javascript:show_page_reg("cgi_ems_ipconfig");'>IP Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_loop_detection");'>Loop Detection Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_port_set");'>Port Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_mirror");'>Port Mirror Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_port_priority");'>Port Priority Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_storm_ctl");'>Storm Control Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_save_configurations");'>Save Configuration</a>
    </div>
    <div id="myDropdownLiteManagementSet_PoE" class="dropdown-content">
        <a href='javascript:show_page_reg("cgi_ems_ipconfig");'>IP Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_loop_detection");'>Loop Detection Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_poe");'>PoE Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_port_set");'>Port Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_mirror");'>Port Mirror Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_port_priority");'>Port Priority Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_storm_ctl");'>Storm Control Configuration</a>
        <a href='javascript:show_page_reg("cgi_ems_save_configurations");'>Save Configuration</a>
    </div>
    <div id="myDropdownChangeIconOnly" class="dropdown-content">
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <div id="myDropdownManualIcon" class="dropdown-content">
        <a id=change_icon name=change_icon
            href="javascript: remote_device_action('change_icon', '04', mac_right_click);">Change ICON</a>
        <a id=delete_icon name=delete_icon
            href="javascript: remote_device_action('delete_icon', '10', mac_right_click);">Delete ICON</a>
        <!--
           <a id=fix_position name=fix_position href="javascript: remote_device_action('fix_position', '06', mac_right_click);">Save Position</a>
           -->
        <a id=edit_icon name=edit_icon href="javascript: remote_device_action('edit_icon', '11', mac_right_click);">Edit
            Content</a>
        <a id=snmp name=snmp href="javascript: remote_device_action('snmp', '15', mac_right_click);">SNMP</a>
    </div>
    <div id="myDropdownAddIcon" class="dropdown-content">
        <a>IP Address<br><input type="text" name="AddIP" id="AddIP" value="" maxlength=15></a>
        <a>MAC Address<br><input type="text" name="AddMAC" id="AddMAC" value="" maxlength=17></a>
        <a>Product Name<br><input type="text" name="AddProductName" id="AddProductName" value="" maxlength=64></a>
        <a>System Name<br><input type="text" name="AddSystemName" id="AddSystemName" value="" maxlength=64></a>
        <a>Parent MAC Address<br><input type="text" name="AddParentMAC" id="AddParentMAC" value="" maxlength=17></a>
        <a>Parent Port<br><input type="text" name="AddParentPort" id="AddParentPort" value="" maxlength=2></a>
        <a>Local Port<br><input type="text" name="AddLocalPort" id="AddLocalPort" value="" maxlength=2></a>
        <a>Ping Check &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="AddPingCheck" id="AddPingCheck"
                value="1"></a>
        <a>SNMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="AddSNMP" id="AddSNMP" value="1"
                onclick="if(document.getElementById('AddSNMP').checked){document.getElementById('AddSNMPCommunityString').style.display='inline-block'}else{document.getElementById('AddSNMPCommunityString').style.display='none'};">
            &nbsp;<input type="text" name="AddSNMPCommunityString" id="AddSNMPCommunityString" value="public"
                style="display: none;width: 85px;" maxlength=10></a>
        <a id=add_icon name=add_icon href="javascript: remote_device_action('add_icon', '05', '');">Add ICON</a>
    </div>
    <div id="myDropdownEditIcon" class="dropdown-content">
        <a>IP Address<br><input type="text" name="EditIP" id="EditIP" value="" maxlength=15></a>
        <a>MAC Address<br><input type="text" name="EditMAC" id="EditMAC" value="" maxlength=17 disabled></a>
        <a>Product Name<br><input type="text" name="EditProductName" id="EditProductName" value="" maxlength=64></a>
        <a>System Name<br><input type="text" name="EditSystemName" id="EditSystemName" value="" maxlength=64></a>
        <a>Parent MAC Address<br><input type="text" name="EditParentMAC" id="EditParentMAC" value="" maxlength=17></a>
        <a>Parent Port<br><input type="text" name="EditParentPort" id="EditParentPort" value="" maxlength=2></a>
        <a>Local Port<br><input type="text" name="EditLocalPort" id="EditLocalPort" value="" maxlength=2></a>
        <a>Ping Check &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="EditPingCheck" id="EditPingCheck"
                value="1"></a>
        <a>SNMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="EditSNMP" id="EditSNMP" value="1"
                onclick="if(document.getElementById('EditSNMP').checked){document.getElementById('EditSNMPCommunityString').style.display='inline-block'}else{document.getElementById('EditSNMPCommunityString').style.display='none'};">
            &nbsp;<input type="text" name="EditSNMPCommunityString" id="EditSNMPCommunityString"
                style="display: none;width: 85px;" maxlength=10></a>
        <a><input name="submit_icon" id="submit_icon" type="button" value="Submit"
                onclick="remote_device_action('submit_icon', '12', '');"></a>
    </div>
    <div id="myDropdownMoveEdge" class="dropdown-content">
        <a>Parent MAC Address<br><input type="text" name="MoveParentMAC" id="MoveParentMAC" value="" maxlength=17></a>
        <a>Parent Port<br><input type="text" name="MoveParentPort" id="MoveParentPort" value="" maxlength=2></a>
        <a>Local Port<br><input type="text" name="MoveLocalPort" id="MoveLocalPort" value="" maxlength=2></a>
        <a><input name="submit_edge" id="submit_edge" type="button" value="Submit"
                onclick="remote_device_action('submit_edge', '13', mac_right_click);">&nbsp;&nbsp;<input
                name="reset_edge" id="reset_edge" type="button" value="Reset"
                onclick="remote_device_action('reset_edge', '14', mac_right_click);"></a>
    </div>
    <div id="myDropdownSetIP" class="dropdown-content">
        <a>User Name<br><input type="text" name="SetIP_username" id="SetIP_username" value="" maxlength=32></a>
        <a>Password<br><input type="password" name="SetIP_password" id="SetIP_password" value="" maxlength=32></a>
        <a>IP Address<br><input type="text" name="SetIP" id="SetIP" maxlength=15></a>
        <a><input name="SetIP_submit" id="SetIP_submit" type="button" value="Submit"
                onclick="SubmitRemoteAction('SetIP', remote_mac);">&nbsp;&nbsp;&nbsp;&nbsp;<font name="SetIP_result"
                id="SetIP_result"></font></a>
    </div>
    <div id="myDropdownReboot" class="dropdown-content">
        <a>User Name<br><input type="text" name="Reboot_username" id="Reboot_username" value="" maxlength=32></a>
        <a>Password<br><input type="password" name="Reboot_password" id="Reboot_password" value="" maxlength=32></a>
        <a><input name="Reboot_submit" id="Reboot_submit" type="button" value="Submit"
                onclick="SubmitRemoteAction('Reboot', remote_mac);">&nbsp;&nbsp;&nbsp;&nbsp;<font name="Reboot_result"
                id="Reboot_result"></font></a>
    </div>
    <div id="myDropdownFactoryDefault" class="dropdown-content">
        <a>User Name<br><input type="text" name="FactoryDefault_username" id="FactoryDefault_username" value=""
                maxlength=32></a>
        <a>Password<br><input type="password" name="FactoryDefault_password" id="FactoryDefault_password" value=""
                maxlength=32></a>
        <a><input name="FactoryDefault_submit" id="FactoryDefault_submit" type="button" value="Submit"
                onclick="SubmitRemoteAction('FactoryDefault', remote_mac);">&nbsp;&nbsp;&nbsp;&nbsp;<font
                name="FactoryDefault_result" id="FactoryDefault_result"></font></a>
    </div>
    <div id="myDropdownSave" class="dropdown-content">
        <a>User Name<br><input type="text" name="Save_username" id="Save_username" value="" maxlength=32></a>
        <a>Password<br><input type="password" name="Save_password" id="Save_password" value="" maxlength=32></a>
        <a><input name="Save_submit" id="Save_submit" type="button" value="Submit"
                onclick="SubmitRemoteAction('Save', remote_mac);">&nbsp;&nbsp;&nbsp;&nbsp;<font name="Save_result"
                id="Save_result"></font></a>
    </div>
    <div id="myDropdownChangeIcon" class="dropdown-content-icon">
        <center><a href="javascript: onUpIcon(0);">/\</a></center>
        <center><a href="javascript: onSetIcon(0);">
                <font id="icon_name" name="icon_name"></font>&nbsp;&nbsp;<img id="icon_img" name="icon_img" src=""
                    width="80%">
            </a></center>
        <center><a href="javascript: onDownIcon(0);">\/</a></center>
    </div>
    <div id="myDropdownSelectIcon" class="dropdown-content-icon">
        <center><a href="javascript: onUpIcon(1);">/\</a></center>
        <center><a href="javascript: onSetIcon(1);">
                <font id="add_icon_name" name="add_icon_name"></font>&nbsp;&nbsp;<img id="add_icon_img"
                    name="add_icon_img" src="" width="80%">
            </a></center>
        <center><a href="javascript: onDownIcon(1);">\/</a></center>
    </div>
    <div id="myDropdownSNMP" class="dropdown-content">
        <a id=snmp_information name=snmp_information
            href="javascript: remote_device_action('snmp_information', '16', mac_right_click);">Information<br></a>
        <a id=snmp_dashboard name=snmp_dashboard
            href="javascript: remote_device_action('snmp_dashboard', '17', mac_right_click);">Dashboard<br></a>
        <a id=snmp_settings name=snmp_settings
            href="javascript: remote_device_action('snmp_settings', '18', mac_right_click);">Remote Settings<br></a>
        <a id=snmp_monitoring name=snmp_monitoring
            href="javascript: remote_device_action('snmp_monitoring', '19', mac_right_click);">Monitoring</a>
    </div>
    <div id="myDropdownRemoteSetting" class="dropdown-content">
        <a id=snmp_system_contact name=snmp_system_contact
            href="javascript: remote_device_action('snmp_system_contact', '20', mac_right_click);">System
            Contact<br></a>
        <a id=snmp_system_name name=snmp_system_name
            href="javascript: remote_device_action('snmp_system_name', '21', mac_right_click);">System Name<br></a>
        <a id=snmp_location name=snmp_location
            href="javascript: remote_device_action('snmp_location', '22', mac_right_click);">Location<br></a>
        <a id=snmp_other_oid name=snmp_other_oid
            href="javascript: remote_device_action('snmp_other_oid', '23', mac_right_click);">Other OID</a>
    </div>


    <script type="text/javascript">
        document.getElementById("myDropdownAddIcon").style.display = "none";
        document.getElementById("myDropdownEditIcon").style.display = "none";
        document.getElementById("myDropdownMoveEdge").style.display = "none";
        document.getElementById("myDropdownSelectIcon").style.display = "none";



        function show_node_menu(ids_right_click, ids_right_click_edge) {
            var found = 0;
            xxx = Math.floor(event.clientX + window.scrollX);
            yyy = Math.floor(event.clientY + window.scrollY);
            document.getElementById("myDropdownSNMP").style.display = "none";
            document.getElementById("myDropdownRemoteSetting").style.display = "none";
            document.getElementById("myDropdownSetIP").style.display = "none";
            document.getElementById("myDropdownReboot").style.display = "none";
            document.getElementById("myDropdownSave").style.display = "none";
            document.getElementById("myDropdownFactoryDefault").style.display = "none";
            document.getElementById("myDropdownChangeIcon").style.display = "none";
            document.getElementById("set_ip").style = 'background-color:#0d0d0d;';
            document.getElementById("reboot").style = 'background-color:#0d0d0d;';
            document.getElementById("factory_default").style = 'background-color:#0d0d0d;';
            document.getElementById("save").style = 'background-color:#0d0d0d;';
            document.getElementById("change_icon").style = 'background-color:#0d0d0d;';
            document.getElementById("add_icon").style = 'background-color:#0d0d0d;';
            document.getElementById("snmp").style = 'background-color:#0d0d0d;';
            document.getElementById("edit_icon").style = 'background-color:#0d0d0d;';
            document.getElementById("delete_icon").style = 'background-color:#0d0d0d;';
            document.getElementById("set_ip").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("set_ip").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("reboot").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("reboot").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("factory_default").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("factory_default").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("save").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("save").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("change_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("change_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("add_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("add_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("delete_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("delete_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("edit_icon").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("edit_icon").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("snmp").onmouseover = function () { this.style.backgroundColor = "#56616A"; }
            document.getElementById("snmp").onmouseout = function () { this.style.backgroundColor = "#0d0d0d"; }
            document.getElementById("myDropdownLiteManagement").style.display = "none";
            document.getElementById("myDropdownLiteManagement_PoE").style.display = "none";
            document.getElementById("myDropdownLiteManagementOnly").style.display = "none";
            document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "none";
            document.getElementById("myDropdownLiteManagementSet").style.display = "none";
            document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
            document.getElementById("myDropdown").style.display = "none";
            document.getElementById("myDropdownChangeIconOnly").style.display = "none";
            document.getElementById("myDropdownManualIcon").style.display = "none";
            document.getElementById("myDropdownEditIcon").style.display = "none";
            document.getElementById("myDropdownMoveEdge").style.display = "none";
            document.getElementById("myDropdownSelectIcon").style.display = "none";
            //if ((lock_state)&&(ids_right_click==null))
            if ((ids_right_click == null) && (ids_right_click_edge == null)) {
                if (document.getElementById("myDropdownAddIcon").style.display == "none") {
                    document.getElementById("myDropdownAddIcon").style.left = xxx + "px";
                    document.getElementById("myDropdownAddIcon").style.top = yyy + "px";
                    document.getElementById("myDropdownAddIcon").style.display = "block";
                }
                else {
                    document.getElementById("myDropdownAddIcon").style.display = "none";
                    document.getElementById("myDropdownSelectIcon").style.display = "none";
                }
            }
            else {
                document.getElementById("myDropdownAddIcon").style.display = "none";
                document.getElementById("myDropdownSelectIcon").style.display = "none";
            }
            if (ids_right_click != null) {
                var str = ids_right_click + "";
                if (str == local_id.toString()) {
                    if (local_mac) {
                        mac_right_click = local_mac;
                        document.getElementById("myDropdown").style.left = xxx + "px";
                        document.getElementById("myDropdown").style.top = yyy + "px";
                        document.getElementById("myDropdown").style.display = "block";
                    }
                }
                var j = neighbor_mac_tmp.indexOf(ids_right_click);
                if (j >= 0) {
                    if (neighbor_mac_tmp[j]) {
                        mac_right_click = neighbor_mac_tmp[j];
                        if (neighbor_snmp_flag[j] == "1") {
                            document.getElementsByName("snmp").forEach(function (item, index) {
                                item.style.display = 'block';
                            })
                        }
                        else {
                            document.getElementsByName("snmp").forEach(function (item, index) {
                                item.style.display = 'none';
                            })
                        }
                        if (neighbor_multicast_remote_set_tmp[j]) {
                            if (neighbor_ems_client[j]) {
                                if (neighbor_poe_supply[j]) {
                                    document.getElementById("myDropdownLiteManagement_PoE").style.left = xxx + "px";
                                    document.getElementById("myDropdownLiteManagement_PoE").style.top = yyy + "px";
                                    document.getElementById("myDropdownLiteManagement_PoE").style.display = "block";
                                }
                                else {
                                    document.getElementById("myDropdownLiteManagement").style.left = xxx + "px";
                                    document.getElementById("myDropdownLiteManagement").style.top = yyy + "px";
                                    document.getElementById("myDropdownLiteManagement").style.display = "block";
                                }
                            }
                            else {
                                document.getElementById("myDropdown").style.left = xxx + "px";
                                document.getElementById("myDropdown").style.top = yyy + "px";
                                document.getElementById("myDropdown").style.display = "block";

                            }
                        }
                        else {
                            if (neighbor_ems_client[j]) {
                                if (neighbor_poe_supply[j]) {
                                    document.getElementById("myDropdownLiteManagementOnly_PoE").style.left = xxx + "px";
                                    document.getElementById("myDropdownLiteManagementOnly_PoE").style.top = yyy + "px";
                                    document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "block";
                                }
                                else {
                                    document.getElementById("myDropdownLiteManagementOnly").style.left = xxx + "px";
                                    document.getElementById("myDropdownLiteManagementOnly").style.top = yyy + "px";
                                    document.getElementById("myDropdownLiteManagementOnly").style.display = "block";
                                }
                            }
                            else {
                                document.getElementById("myDropdownChangeIconOnly").style.left = xxx + "px";
                                document.getElementById("myDropdownChangeIconOnly").style.top = yyy + "px";
                                document.getElementById("myDropdownChangeIconOnly").style.display = "block";
                            }
                        }
                        current_mac = neighbor_mac_tmp[j];
                        var node = nodes.get(current_mac);
                        current_img = node.image;
                        found = 1;
                    }
                }
                j = manual_neighbor_mac.indexOf(ids_right_click);
                if (j >= 0) {
                    if (manual_neighbor_mac[j]) {
                        if (manual_neighbor_snmp_flag[j] == "1") {
                            document.getElementsByName("snmp").forEach(function (item, index) {
                                item.style.display = 'block';
                            })
                        }
                        else {
                            document.getElementsByName("snmp").forEach(function (item, index) {
                                item.style.display = 'none';
                            })
                        }
                        mac_right_click = manual_neighbor_mac[j];
                        document.getElementById("myDropdownManualIcon").style.left = xxx + "px";
                        document.getElementById("myDropdownManualIcon").style.top = yyy + "px";
                        document.getElementById("myDropdownManualIcon").style.display = "block";
                        current_mac = manual_neighbor_mac[j];
                        var node = nodes.get(current_mac);
                        current_img = node.image;
                        found = 1;

                    }
                }
                if (!found) {
                    j = lock_neighbor_mac.indexOf(ids_right_click);
                    if (j >= 0) {
                        if (lock_neighbor_mac[j]) {
                            if (lock_neighbor_mac[j] == "1") {
                                document.getElementsByName("snmp").forEach(function (item, index) {
                                    item.style.display = 'block';
                                })
                            }
                            else {
                                document.getElementsByName("snmp").forEach(function (item, index) {
                                    item.style.display = 'none';
                                })
                            }
                            mac_right_click = lock_neighbor_mac[j];
                            document.getElementById("myDropdownChangeIconOnly").style.left = xxx + "px";
                            document.getElementById("myDropdownChangeIconOnly").style.top = yyy + "px";
                            document.getElementById("myDropdownChangeIconOnly").style.display = "block";
                            current_img = lock_neighbor_img[j];
                            current_mac = lock_neighbor_mac[j];
                            found = 1;
                        }
                    }
                }
            }
            else {
                if (ids_right_click_edge != null) {
                    var mac_id = "";
                    if (ids_right_click_edge.substring(0, 2) == "to")
                        mac_id = ids_right_click_edge.substring(2, 14);
                    if (ids_right_click_edge.substring(12, 14) == "to")
                        mac_id = ids_right_click_edge.substring(0, 12);
                    if (mac_id != "") {
                        var is_dot_line = 0;
                        mac_right_click = mac_id;
                        var i = neighbor_mac.indexOf(mac_id);
                        if (i >= 0) {
                            if ((neighbor_parent_id[i] == 1) && (neighbor_with_host_port[i] == -1))
                                is_dot_line = 1;
                        }
                        i = manual_neighbor_mac.indexOf(mac_id);
                        if (i >= 0) {
                            if ((manual_neighbor_parent_id[i] == 1) && (manual_neighbor_with_host_port[i] == -1))
                                is_dot_line = 1;
                        }
                        if (lock_state) {
                            i = lock_neighbor_mac.indexOf(mac_id);
                            if (i >= 0) {
                                if ((lock_neighbor_parent_id[i] == 1) && (lock_neighbor_with_host_port[i] == -1))
                                    is_dot_line = 1;
                            }
                        }
                        if (is_dot_line) {
                            i = move_neighbor_mac.indexOf(mac_id);
                            if (i >= 0) {
                                document.getElementById("MoveParentMAC").value = mac12_to_mac17(move_neighbor_parent_id[i]);
                                document.getElementById("MoveParentPort").value = move_neighbor_with_host_port[i];
                                document.getElementById("MoveLocalPort").value = move_neighbor_local_port[i];
                            }
                            else {
                                document.getElementById("MoveParentMAC").value = "";
                                document.getElementById("MoveParentPort").value = "";
                                document.getElementById("MoveLocalPort").value = "";
                            }
                            document.getElementById("myDropdownMoveEdge").style.left = xxx + "px";
                            document.getElementById("myDropdownMoveEdge").style.top = yyy + "px";
                            document.getElementById("myDropdownMoveEdge").style.display = "block";
                        }
                    }
                }
            }
        }

        function clusterByCid() {
            if (remote_set_processing())
                return;
            document.getElementById("Unlock_Map").disabled = true;
            document.getElementById("Unlock_Map").src = "images/unlock_disable.png";
            //document.getElementById("Lock_Map").disabled=true;
            document.getElementById("select_style").options[1].disabled = true
            document.getElementById("select_style").options[2].disabled = true
            //document.getElementById("Style_STAR").disabled = true;
            //document.getElementById("Style_LEVEL").disabled = true;
            network.setData(data);
            var html_title = "<table>";
            html_title += "<tr><td>IP Address</td><td>" + local_ip + "</td></tr>";
            html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(local_mac) + "</td></tr>";
            html_title += "<tr><td>Product Name</td><td>" + local_product_name + "</td></tr>";
            html_title += "<tr><td>System Name</td><td>" + local_system_name + "</td></tr>";
            html_title += "</table>";
            var x_axis_cluster = parseInt(getCookie((local_mac + '_x')), 10);
            var y_axis_cluster = parseInt(getCookie((local_mac + '_y')), 10);
            var select_cid = document.getElementById('select_cid').value;
            if (parseInt(getCookie('positions_enable'), 10) == 1)
            //if (current_lock_state)
            {
                var clusterOptionsByData = {
                    joinCondition: function (childOptions) {
                        //return childOptions.cid != 1;
                        return childOptions.cid != select_cid;
                    },
                    //clusterNodeProperties: {id:'cidCluster', borderWidth:3, shape:'database'}
                    clusterNodeProperties: { x: x_axis_cluster, y: y_axis_cluster, id: 'cidCluster', shape: 'image', size: 60, title: html_title, image: ('ems_images/' + local_product_name + '-unknown.gif'), label: select_cid.toString(), font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20 } }
                };
            }
            else {
                var clusterOptionsByData = {
                    joinCondition: function (childOptions) {
                        //return childOptions.cid != 1;
                        return childOptions.cid != select_cid;
                    },
                    //clusterNodeProperties: {id:'cidCluster', borderWidth:3, shape:'database'}
                    clusterNodeProperties: { id: 'cidCluster', shape: 'image', size: 60, title: html_title, image: ('ems_images/' + local_product_name + '-unknown.gif'), label: select_cid.toString(), font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20 } }
                };
            }
            network.cluster(clusterOptionsByData);
        }
        
        
        //$("body").css("overflow", "hidden");
        
        
        // ------------------------------------------------


        // Network的東西來了
        
        
        var nodes, edges, network;
        var zoom_position = [];
        var scale_global;
        var neighbor_mac_tmp = [];
        var neighbor_alarm_info_tmp = [];
        var neighbor_multicast_remote_set_tmp = [];
        var neighbor_ip_tmp = [];
        var edges_length = 150;
        var data;


        //新增判斷，控制edge text的顯示
        var temp_neighbor_with_host_port = "";
        var temp_neighbor_local_port = "";


        function edge_port_display(port_no) {
            if (port_no == -1 || port_no == 0)
                return '';
            else
                return port_no;
        }


        function createNetwork(easingType) {
            var local_img_str;
            var i, j;
            var edges_color;
            var edge_label;
            var edge_label2;
            var edge_html_title;
            var positions_enable = parseInt(getCookie('positions_enable'), 10);
            var html_title = "<table>";
            html_title += "<tr><td>IP Address</td><td>" + local_ip + "</td></tr>";
            html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(local_mac) + "</td></tr>";
            html_title += "<tr><td>Product Name</td><td>" + local_product_name + "</td></tr>";
            html_title += "<tr><td>System Name</td><td>" + local_system_name + "</td></tr>";
            html_title += "</table>";
            //if (ems_images_model_name.indexOf(local_product_name) >= 0) {
            //    local_img_str = 'ems_images/' + local_product_name + '-unknown.gif';
            //} else {
            //    local_img_str = 'ems_images/generic-unknown.gif';
            //    for (j = 0; j < ems_images_model_name.length; j++) {
            //        if (local_product_name.indexOf(ems_images_model_name[j]) >= 0) {
            //            local_img_str = 'ems_images/' + ems_images_model_name[j] + '-unknown.gif';
            //            break;
            //        }
            //    }
            //}
            local_img_str = 'ems_images/HMI-unknown.gif';

            nodesArray = [];
            edgesArray = [];
            edges_color = '#000000';
            if (lock_state) {
                var x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + local_mac);
                var y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + local_mac);
                if ((x_axis_tmp != null) && (y_axis_tmp != null)) {
                    //console.log(local_mac+" "+x_axis_tmp+" "+y_axis_tmp);
                    //nodesArray.push({x: x_axis_tmp, y: y_axis_tmp, id: local_id, fixed: true, shape: 'image', size: 60, title: html_title, image: local_img_str, font:{size:12}});
                    nodesArray.push({ x: x_axis_tmp, y: y_axis_tmp, id: local_id, shape: 'image', size: 60, title: html_title, image: local_img_str, font: { size: 12 } });
                    if (local_alarm_info)
                        nodesArray.push({ x: x_axis_tmp + host_alarm_image_offset_x, y: y_axis_tmp + host_alarm_image_offset_y, fixed: true, id: local_mac + "alarm", shape: 'image', size: 20, image: alert_img_str });
                    else
                        nodesArray.push({ x: x_axis_tmp + host_alarm_image_offset_x, y: y_axis_tmp + host_alarm_image_offset_y, fixed: true, id: local_mac + "alarm", shape: 'image', size: 20, image: empty_img_str });
                }
                else {
                    nodesArray.push({ id: local_id, shape: 'image', size: 60, title: html_title, image: local_img_str, font: { size: 12 } });
                    nodesArray.push({ id: local_mac + "alarm", shape: 'image', size: 20, image: empty_img_str });
                }
            }
            else {
                nodesArray.push({ id: local_id, shape: 'image', size: 60, title: html_title, image: local_img_str, font: { size: 12 } });
                nodesArray.push({ id: local_mac + "alarm", hidden: true, shape: 'image', size: 20, image: empty_img_str });
            }
            for (i = 0; i < neighbor_mac.length; i++) {
                if (neighbor_mac[i]) {
                    var img_str;
                    var neighbor_product_name_tmp = neighbor_product_name[i].split(" ", 1);
                    html_title = "<table>";
                    if (neighbor_ip[i] == "0.0.0.0")
                        html_title += "<tr><td>IP Address</td><td>-</td></tr>";
                    else
                        html_title += "<tr><td>IP Address</td><td>" + neighbor_ip[i] + "</td></tr>";
                    html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(neighbor_mac[i]) + "</td></tr>";
                    html_title += "<tr><td>Product Name</td><td>" + neighbor_product_name_tmp + "</td></tr>";
                    html_title += "<tr><td>System Name</td><td>" + neighbor_system_name[i] + "</td></tr>";
                    html_title += "</table>";
                    //html_title = html_title.replaceAll("&", "&amp;");
                    if (ems_images_model_name.indexOf(neighbor_product_name_tmp) >= 0) {
                        img_str = 'ems_images/' + neighbor_product_name_tmp + '-unknown.gif';
                    } else {
                        img_str = 'ems_images/generic-unknown.gif';
                        for (j = 0; j < ems_images_model_name.length; j++) {
                            if (neighbor_product_name_tmp.indexOf(ems_images_model_name[j]) >= 0) {
                                img_str = 'ems_images/' + ems_images_model_name[j] + '-unknown.gif';
                                break;
                            }
                        }
                    }
                    if ((demo) || (getCookie('ems_just_set_icon_id') == neighbor_mac[i])) {
                        var tmp_neighbor_img = getCookie(neighbor_mac[i] + '_img');
                        if (tmp_neighbor_img != neighbor_img[i])
                            neighbor_img[i] = tmp_neighbor_img;
                        else
                            deleteCookie('ems_just_set_icon_id');
                    }
                    if (neighbor_img[i] != "")
                        img_str = neighbor_img[i];
                    else
                        neighbor_img[i] = img_str;
                    edges_font_color = '#000000';
                    if ((neighbor_with_host_port[i] == -1) || (neighbor_with_host_port[i] == 0))
                        edge_label = '';
                    else
                        edge_label = '' + neighbor_with_host_port[i].toString();
                    if ((neighbor_local_port[i] == -1) || (neighbor_local_port[i] == 0))
                        edge_label2 = '';
                    else
                        edge_label2 = '' + neighbor_local_port[i].toString();
                    edge_html_title = "<table>";


                    if (neighbor_local_port[i] == 0)
                        edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(neighbor_with_host_port[i]) + "<--->?</td></tr>";
                    else if (neighbor_local_port[i] == -1)
                        edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(neighbor_with_host_port[i]) + "<--->" + edge_port_display(neighbor_local_port[i]) + "</td></tr>";
                    else
                        edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(neighbor_with_host_port[i]) + "<--->" + edge_port_display(neighbor_local_port[i]) + "</td></tr>";
                    edge_html_title += "</table>";


                    if (lock_state) {
                        if (lock_neighbor_mac.indexOf(neighbor_mac[i]) >= 0) {
                            var x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + neighbor_mac[i]);
                            var y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + neighbor_mac[i]);
                            if ((x_axis_tmp != null) && (y_axis_tmp != null)) {
                                //console.log(neighbor_mac[i]+" "+x_axis_tmp+" "+y_axis_tmp);
                                //nodesArray.push({x: x_axis_tmp, y: y_axis_tmp, id: neighbor_mac[i], fixed: true, cid: neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font:{size:12}});

                                nodesArray.push({ x: x_axis_tmp, y: y_axis_tmp, id: neighbor_mac[i], cid: neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });

                                if (neighbor_alarm_info[i])
                                    nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, fixed: true, id: neighbor_mac[i] + "alarm", shape: 'image', size: 15, image: alert_img_str });
                                else
                                    nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, fixed: true, id: neighbor_mac[i] + "alarm", shape: 'image', size: 15, image: empty_img_str });
                                if (neighbor_with_host_port[i] == -1) {
                                    edge_html_title = "<table>";
                                    edge_html_title += "<tr><td>From Port #" + edge_port_display(neighbor_under_master_port[i]) + " (Right click to change parent)</td></tr>";
                                    edge_html_title += "</table>";
                                    edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, dashes: [1, 10], label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_green, highlight: edges_green } });
                                    edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_green, highlight: edges_green, opacity: 0 } });
                                }
                                else {
                                    edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_green, highlight: edges_green } });
                                    edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_green, highlight: edges_green, opacity: 0 } });
                                }
                            }
                            else {
                                //console.log("Known issue: Click Lock when background device data has updated but forground topology map has not updated. (new device data has locked but position data has not locked)");
                                if (neighbor_parent_id[i] == local_id.toString()) {
                                    x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + local_mac);
                                    y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + local_mac);
                                }
                                else {
                                    x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + neighbor_parent_id[i]);
                                    y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + neighbor_parent_id[i]);
                                }
                                x_axis_tmp = x_axis_tmp + 50;
                                y_axis_tmp = y_axis_tmp + 100;
                                nodesArray.push({ x: x_axis_tmp, y: y_axis_tmp, id: neighbor_mac[i], cid: neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                                if (neighbor_alarm_info[i])
                                    nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: neighbor_mac[i] + "alarm", hidden: false, shape: 'image', size: 15, image: alert_img_str });
                                else
                                    nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: neighbor_mac[i] + "alarm", hidden: false, shape: 'image', size: 15, image: empty_img_str });
                                if (neighbor_with_host_port[i] == -1) {
                                    edge_html_title = "<table>";
                                    edge_html_title += "<tr><td>From Port #" + temp_neighbor_with_host_port + " (Right click to change parent)</td></tr>";
                                    edge_html_title += "</table>";
                                    edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, dashes: [1, 10], label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_green, highlight: edges_green } });
                                    edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_green, highlight: edges_green, opacity: 0 } });
                                }
                                else {
                                    edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_green, highlight: edges_green } });
                                    edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_green, highlight: edges_green, opacity: 0 } });
                                }
                            }
                        }
                    }
                    else {
                        nodesArray.push({ id: neighbor_mac[i], cid: neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                        nodesArray.push({ id: neighbor_mac[i] + "alarm", hidden: true, shape: 'image', size: 15, image: empty_img_str });
                        if (neighbor_with_host_port[i] == -1) {
                            edge_html_title = "<table>";
                            edge_html_title += "<tr><td>From Port #" + temp_neighbor_with_host_port + " (Right click to change parent)</td></tr>";
                            edge_html_title += "</table>";
                            edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, dashes: [1, 10], label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_color, highlight: edges_color } });
                            edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_color, highlight: edges_color, opacity: 0 } });
                        }
                        else {
                            edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_color, highlight: edges_color } });
                            edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_color, highlight: edges_color, opacity: 0 } });
                        }
                    }
                }
            }
            if (lock_state == 1) {
                for (i = 0; i < lock_neighbor_mac.length; i++) {
                    if (neighbor_mac.indexOf(lock_neighbor_mac[i]) == -1) {
                        if (lock_neighbor_mac[i]) {
                            var img_str;
                            var neighbor_product_name_tmp = lock_neighbor_product_name[i].split(" ", 1);
                            var x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + lock_neighbor_mac[i]);
                            var y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + lock_neighbor_mac[i]);
                            html_title = "<table>";
                            if (lock_neighbor_ip[i] == "0.0.0.0")
                                html_title += "<tr><td>IP Address</td><td>-</td></tr>";
                            else
                                html_title += "<tr><td>IP Address</td><td>" + lock_neighbor_ip[i] + "</td></tr>";
                            html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(lock_neighbor_mac[i]) + "</td></tr>";
                            html_title += "<tr><td>Product Name</td><td>" + neighbor_product_name_tmp + "</td></tr>";
                            html_title += "<tr><td>System Name</td><td>" + lock_neighbor_system_name[i] + "</td></tr>";
                            html_title += "</table>";
                            if (ems_images_model_name.indexOf(neighbor_product_name_tmp) >= 0) {
                                img_str = 'ems_images/' + neighbor_product_name_tmp + '-unknown.gif';
                            } else {
                                img_str = 'ems_images/generic-unknown.gif';
                                for (j = 0; j < ems_images_model_name.length; j++) {
                                    if (neighbor_product_name_tmp.indexOf(ems_images_model_name[j]) >= 0) {
                                        img_str = 'ems_images/' + ems_images_model_name[j] + '-unknown.gif';
                                        break;
                                    }
                                }
                            }
                            if ((demo) || (getCookie('ems_just_set_icon_id') == lock_neighbor_img[i])) {
                                var tmp_neighbor_img = getCookie(lock_neighbor_img[i] + '_img');
                                if (tmp_neighbor_img != lock_neighbor_img[i])
                                    lock_neighbor_img[i] = tmp_neighbor_img;
                                else
                                    deleteCookie('ems_just_set_icon_id');
                            }
                            if (lock_neighbor_img[i] != "")
                                img_str = lock_neighbor_img[i];
                            else
                                lock_neighbor_img[i] = img_str;
                            edges_font_color = '#000000';
                            if ((lock_neighbor_with_host_port[i] == -1) || (lock_neighbor_with_host_port[i] == 0))
                                edge_label = '';
                            else
                                edge_label = '' + lock_neighbor_with_host_port[i].toString();
                            if ((lock_neighbor_local_port[i] == -1) || (lock_neighbor_local_port[i] == 0))
                                edge_label2 = '';
                            else
                                edge_label2 = '' + lock_neighbor_local_port[i].toString();
                            edge_html_title = "<table>";


                            if (lock_neighbor_local_port[i] == 0)
                                edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(lock_neighbor_with_host_port[i]) + "<--->?</td></tr>";
                            else
                                edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(lock_neighbor_with_host_port[i]) + "<--->" + edge_port_display(lock_neighbor_local_port[i]) + "</td></tr>";
                            edge_html_title += "</table>";
                            //nodesArray.push({x: x_axis_tmp, y: y_axis_tmp, fixed: true, id: lock_neighbor_mac[i], cid: lock_neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font:{size:12}});
                            //nodesArray.push({x: x_axis_tmp+alarm_image_offset_x, y: y_axis_tmp+alarm_image_offset_y, fixed: true, id: lock_neighbor_mac[i]+"alarm", shape: 'image', size: 15, image: empty_img_str});
                            nodesArray.push({ x: x_axis_tmp, y: y_axis_tmp, id: lock_neighbor_mac[i], cid: lock_neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                            //nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: lock_neighbor_mac[i] + "alarm", shape: 'image', size: 15, image: empty_img_str });
                            nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: lock_neighbor_mac[i] + "alarm", shape: 'image', size: 15, image: critical_img_str, fixed: true, title: "Disconnect" });
                            if (lock_neighbor_with_host_port[i] == -1) {
                                edge_html_title = "<table>";
                                edge_html_title += "<tr><td>From Port #" + lock_neighbor_under_master_port[i] + " (Right click to change parent)</td></tr>";
                                edge_html_title += "</table>";
                                edgesArray.push({ id: lock_neighbor_mac[i] + "to", from: lock_neighbor_mac[i], to: lock_neighbor_parent_id[i], length: edges_length, dashes: [1, 10], label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_red, highlight: edges_red } });
                                edgesArray.push({ id: "to" + lock_neighbor_mac[i], from: lock_neighbor_mac[i], to: lock_neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_red, highlight: edges_red, opacity: 0 } });
                            }
                            else {
                                edgesArray.push({ id: lock_neighbor_mac[i] + "to", from: lock_neighbor_mac[i], to: lock_neighbor_parent_id[i], length: edges_length, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_red, highlight: edges_red } });
                                edgesArray.push({ id: "to" + lock_neighbor_mac[i], from: lock_neighbor_mac[i], to: lock_neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_red, highlight: edges_red, opacity: 0 } });
                            }
                        }
                    }
                }
            }
            if (lock_state) {
                for (i = 0; i < neighbor_mac.length; i++) {
                    if (neighbor_mac[i]) {
                        var img_str;
                        var neighbor_product_name_tmp = neighbor_product_name[i].split(" ", 1);
                        html_title = "<table>";
                        if (neighbor_ip[i] == "0.0.0.0")
                            html_title += "<tr><td>IP Address</td><td>-</td></tr>";
                        else
                            html_title += "<tr><td>IP Address</td><td>" + neighbor_ip[i] + "</td></tr>";
                        html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(neighbor_mac[i]) + "</td></tr>";
                        html_title += "<tr><td>Product Name</td><td>" + neighbor_product_name_tmp + "</td></tr>";
                        html_title += "<tr><td>System Name</td><td>" + neighbor_system_name[i] + "</td></tr>";
                        html_title += "</table>";
                        if (ems_images_model_name.indexOf(neighbor_product_name_tmp) >= 0) {
                            img_str = 'ems_images/' + neighbor_product_name_tmp + '-unknown.gif';
                        } else {
                            img_str = 'ems_images/generic-unknown.gif';
                            for (j = 0; j < ems_images_model_name.length; j++) {
                                if (neighbor_product_name_tmp.indexOf(ems_images_model_name[j]) >= 0) {
                                    img_str = 'ems_images/' + ems_images_model_name[j] + '-unknown.gif';
                                    break;
                                }
                            }
                        }
                        if ((demo) || (getCookie('ems_just_set_icon_id') == neighbor_mac[i])) {
                            var tmp_neighbor_img = getCookie(neighbor_mac[i] + '_img');
                            if (tmp_neighbor_img != neighbor_img[i])
                                neighbor_img[i] = tmp_neighbor_img;
                            else
                                deleteCookie('ems_just_set_icon_id');
                        }
                        if (neighbor_img[i] != "")
                            img_str = neighbor_img[i];
                        else
                            neighbor_img[i] = img_str;
                        edges_font_color = '#000000';
                        if ((neighbor_with_host_port[i] == -1) || (neighbor_with_host_port[i] == 0))
                            edge_label = '';
                        else
                            edge_label = '' + neighbor_with_host_port[i].toString();
                        if ((neighbor_local_port[i] == -1) || (neighbor_local_port[i] == 0))
                            edge_label2 = '';
                        else
                            edge_label2 = '' + neighbor_local_port[i].toString();
                        edge_html_title = "<table>";


                        if (neighbor_local_port[i] == 0)
                            edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(neighbor_with_host_port[i]) + "<--->?</td></tr>";
                        else
                            edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(neighbor_with_host_port[i]) + "<--->" + edge_port_display(neighbor_local_port[i]) + "</td></tr>";
                        edge_html_title += "</table>";
                        //if (lock_state)
                        //{
                        if (lock_neighbor_mac.indexOf(neighbor_mac[i]) == -1) {
                            nodesArray.push({ id: neighbor_mac[i], cid: neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                            if (neighbor_alarm_info[i])
                                nodesArray.push({ id: neighbor_mac[i] + "alarm", hidden: false, shape: 'image', size: 15, image: alert_img_str });
                            else
                                nodesArray.push({ id: neighbor_mac[i] + "alarm", hidden: true, shape: 'image', size: 15, image: empty_img_str });
                            if (neighbor_with_host_port[i] == -1) {
                                edge_html_title = "<table>";
                                edge_html_title += "<tr><td>From Port #" + neighbor_under_master_port[i] + " (Right click to change parent)</td></tr>";
                                edge_html_title += "</table>";
                                edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, dashes: [1, 10], label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_yellow, highlight: edges_yellow } });
                                edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_yellow, highlight: edges_yellow, opacity: 0 } });
                            }
                            else {
                                edgesArray.push({ id: neighbor_mac[i] + "to", from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: edges_yellow, highlight: edges_yellow } });
                                edgesArray.push({ id: "to" + neighbor_mac[i], from: neighbor_mac[i], to: neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: edges_yellow, highlight: edges_yellow, opacity: 0 } });
                            }
                        }
                        //}
                    }
                }
            }
            for (i = 0; i < manual_neighbor_mac.length; i++) {
                if (manual_neighbor_mac[i]) {
                    //if (neighbor_mac.indexOf(manual_neighbor_mac[i]) >= 0)
                    //    break;
                    var img_str;
                    var neighbor_product_name_tmp = manual_neighbor_product_name[i].split(" ", 1);
                    var x_axis_tmp = eval("document.lldp_manual_neighbor_xy.x" + manual_neighbor_mac[i]);
                    var y_axis_tmp = eval("document.lldp_manual_neighbor_xy.y" + manual_neighbor_mac[i]);
                    var temp_edges_color = edges_blue;
                    html_title = "<table>";
                    if (manual_neighbor_ip[i] == "0.0.0.0")
                        html_title += "<tr><td>IP Address</td><td>-</td></tr>";
                    else
                        html_title += "<tr><td>IP Address</td><td>" + manual_neighbor_ip[i] + "</td></tr>";
                    html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(manual_neighbor_mac[i]) + "</td></tr>";
                    html_title += "<tr><td>Product Name</td><td>" + neighbor_product_name_tmp + "</td></tr>";
                    html_title += "<tr><td>System Name</td><td>" + manual_neighbor_system_name[i] + "</td></tr>";
                    html_title += "</table>";
                    if (ems_images_model_name.indexOf(neighbor_product_name_tmp) >= 0) {
                        img_str = 'ems_images/' + neighbor_product_name_tmp + '-unknown.gif';
                    } else {
                        img_str = 'ems_images/generic-unknown.gif';
                        for (j = 0; j < ems_images_model_name.length; j++) {
                            if (neighbor_product_name_tmp.indexOf(ems_images_model_name[j]) >= 0) {
                                img_str = 'ems_images/' + ems_images_model_name[j] + '-unknown.gif';
                                break;
                            }
                        }
                    }
                    if ((demo) || (getCookie('ems_just_set_icon_id') == manual_neighbor_mac[i])) {
                        var tmp_neighbor_img = getCookie(manual_neighbor_mac[i] + '_img');
                        if (tmp_neighbor_img != manual_neighbor_img[i])
                            manual_neighbor_img[i] = tmp_neighbor_img;
                        else
                            deleteCookie('ems_just_set_icon_id');
                    }
                    if (manual_neighbor_img[i] != "")
                        img_str = manual_neighbor_img[i];
                    else
                        manual_neighbor_img[i] = img_str;
                    edges_font_color = '#000000';
                    if ((manual_neighbor_with_host_port[i] == -1) || (manual_neighbor_with_host_port[i] == 0))
                        edge_label = '';
                    else
                        edge_label = '' + manual_neighbor_with_host_port[i].toString();
                    if ((manual_neighbor_local_port[i] == -1) || (manual_neighbor_local_port[i] == 0))
                        edge_label2 = '';
                    else
                        edge_label2 = '' + manual_neighbor_local_port[i].toString();
                    edge_html_title = "<table>";

                    if (manual_neighbor_local_port[i] == 0)
                        edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(manual_neighbor_with_host_port[i]) + "<--->?</td></tr>";
                    else
                        edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(manual_neighbor_with_host_port[i]) + "<--->" + edge_port_display(manual_neighbor_local_port[i]) + "</td></tr>";
                    edge_html_title += "</table>";
                    if (lock_state) {
                        var ping_result = 1;
                        if (manual_neighbor_ping_check[i] != "0.0.0.0") {
                            ping_result = eval("document.lldp_manual_neighbor_ping.ping" + manual_neighbor_mac[i]);
                            if (ping_result == 1) {
                                temp_edges_color = edges_green;
                            }
                            else {
                                temp_edges_color = edges_red;
                            }
                        }
                        nodesArray.push({ x: x_axis_tmp, y: y_axis_tmp, id: manual_neighbor_mac[i], cid: manual_neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                        if (manual_neighbor_alarm_info[i]) {
                            if (ping_result == 1)
                                nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: manual_neighbor_mac[i] + "alarm", hidden: false, shape: 'image', size: 15, image: alert_img_str });
                            else
                                nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: manual_neighbor_mac[i] + "alarm", hidden: false, shape: 'image', size: 15, image: empty_img_str });
                        }
                        else
                            nodesArray.push({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: manual_neighbor_mac[i] + "alarm", hidden: false, shape: 'image', size: 15, image: empty_img_str });
                    }
                    else
                        nodesArray.push({ id: manual_neighbor_mac[i], cid: manual_neighbor_cid[i], shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                    if (manual_neighbor_with_host_port[i] == -1) {
                        edgesArray.push({ id: manual_neighbor_mac[i] + "to", from: manual_neighbor_mac[i], to: manual_neighbor_parent_id[i], length: edges_length, dashes: [1, 10], label: edge_label, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: temp_edges_color, highlight: temp_edges_color } });
                        edgesArray.push({ id: "to" + manual_neighbor_mac[i], from: manual_neighbor_mac[i], to: manual_neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: temp_edges_color, highlight: temp_edges_color, opacity: 0 } });
                    }
                    else {
                        edgesArray.push({ id: manual_neighbor_mac[i] + "to", from: manual_neighbor_mac[i], to: manual_neighbor_parent_id[i], length: edges_length, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' }, color: { color: temp_edges_color, highlight: temp_edges_color } });
                        edgesArray.push({ id: "to" + manual_neighbor_mac[i], from: manual_neighbor_mac[i], to: manual_neighbor_parent_id[i], length: edges_length, label: edge_label2, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' }, color: { color: temp_edges_color, highlight: temp_edges_color, opacity: 0 } });
                    }
                }
            }


            // TODO: 搞懂這個

            nodes = new vis.DataSet(nodesArray);
            edges = new vis.DataSet(edgesArray);

            for (i = 0; i < move_neighbor_mac.length; i++) {
                if (move_neighbor_mac[i]) {
                    var found = 0;
                    if (neighbor_mac.indexOf(move_neighbor_parent_id[i]) >= 0)
                        found = 1;
                    else
                        if (manual_neighbor_mac.indexOf(move_neighbor_parent_id[i]) >= 0)
                            found = 1;
                        else
                            if (lock_state) {
                                if (lock_neighbor_mac.indexOf(move_neighbor_parent_id[i]) >= 0)
                                    found = 1;
                            }
                    if (found) {
                        edge_label = '' + move_neighbor_with_host_port[i].toString();
                        edge_label2 = '' + move_neighbor_local_port[i].toString();
                        edge_html_title = "<table>";

                        if (move_neighbor_local_port[i] == 0)
                            edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(move_neighbor_with_host_port[i]) + "<--->? (Right click to change parent)</td></tr>";
                        else
                            edge_html_title += "<tr><td>link Port #</td><td>" + edge_port_display(move_neighbor_with_host_port[i]) + "<--->" + edge_port_display(move_neighbor_local_port[i]) + " (Right click to change parent)</td></tr>";
                        edge_html_title += "</table>";
                        edges.update({ id: move_neighbor_mac[i] + "to", from: move_neighbor_mac[i], to: move_neighbor_parent_id[i], length: edges_length, dashes: false, label: edge_label, title: edge_html_title, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'top' } });
                        edges.update({ id: "to" + move_neighbor_mac[i], from: move_neighbor_mac[i], to: move_neighbor_parent_id[i], length: edges_length, dashes: false, label: edge_label2, font: { color: '#000000', strokeWidth: 2, strokeColor: edges_font_color, size: 20, align: 'bottom' } });
                    }
                }
            }



            var container = document.getElementById('mynetwork');


            data = {
                nodes: nodes,
                edges: edges
            };

            // options = {
            //     nodes: {
            //         borderWidth: 4,
            //         borderWidthSelected: 6,
            //         size: 24,
            //         color: {
            //             border: "transparent",
            //             background: "#d2d2d2c8",
            //             highlight: {
            //                 border: "pink",
            //                 background: "white",
            //             },
            //         },
            //         font: { color: "#eeeeee" },
            //         shapeProperties: {
            //             useBorderWithImage: true,
            //         },
            //     },
            //     edges: {
            //         color: "lightgray",
            //     },
            // };


            //if ((!lock_state)&&(topology_style==1))
            if (topology_style == 1) {
                var options = {
                    physics: {
                        barnesHut: {
                            avoidOverlap: 1,
                            gravitationalConstant: -30000,
                        },
                    },
                    edges: {
                        smooth: {
                            type: 'continuous', // type: continuous, diagonalCross, straightCross, vertical, cubicBezier, curvedCW
                            forceDirection: 'vertical', // forceDirection: horizontal, vertical, none
                            roundness: 1
                        },
                        width: 3,
                        selectionWidth: 1,

                        font: {
                            size: 12,
                        },
                        chosen: {
                        },
                    },
                    interaction: {
                        zoomView: false,
                        navigationButtons: false,
                        keyboard: false
                    },
                    layout: {
                        randomSeed: 2,
                        hierarchical: {
                            direction: "DU",
                            sortMethod: "directed"
                        }
                    },
                };
            }
            else {
                var options = {
                    physics: {
                        barnesHut: {
                            avoidOverlap: 1,
                            gravitationalConstant: -30000,
                        },
                    },
                    edges: {
                        smooth: {
                            type: 'continuous', // type: continuous, diagonalCross, straightCross, vertical, cubicBezier, curvedCW
                            forceDirection: 'vertical', // forceDirection: horizontal, vertical, none
                            roundness: 1
                        },
                        width: 3,
                        selectionWidth: 1,

                        font: {
                            size: 12,
                        },
                    },
                    interaction: {
                        zoomView: false,
                        navigationButtons: false,
                        keyboard: false
                    },
                    //configure: true,
                    layout: {
                        randomSeed: 9,
                    },
                };
            }


            // ------------------------------------------------


            // 把network畫出來
            network = new vis.Network(container, data, options);


            // ------------------------------------------------



            network.once("beforeDrawing", function () {
                network.focus(1, {
                    scale: 1
                });
                network.moveTo({
                    position: { x: 0, y: 0 }
                });
            });
            //network.once("afterDrawing", function() {
            //    network.fit({
            //        animation: {
            //            duration: 0,
            //            easingFunction: easingType
            //        }
            //    });
            //});


            var ids;


            network.on('click', function (properties) {
                ids = properties.nodes;
                //console.log("Click Node: ["+ids+"]");
                document.getElementById("myDropdownSetIP").style.display = "none";
                document.getElementById("myDropdownReboot").style.display = "none";
                document.getElementById("myDropdownFactoryDefault").style.display = "none";
                document.getElementById("myDropdownSave").style.display = "none";
                document.getElementById("myDropdownChangeIcon").style.display = "none";
                document.getElementById("myDropdownChangeIconOnly").style.display = "none";
                document.getElementById("myDropdown").style.display = "none";
                document.getElementById("myDropdownLiteManagementSet").style.display = "none";
                document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
                document.getElementById("myDropdownLiteManagement").style.display = "none";
                document.getElementById("myDropdownLiteManagement_PoE").style.display = "none";
                document.getElementById("myDropdownLiteManagementOnly").style.display = "none";
                document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "none";
                document.getElementById("myDropdownAddIcon").style.display = "none";
                document.getElementById("myDropdownEditIcon").style.display = "none";
                document.getElementById("myDropdownMoveEdge").style.display = "none";
                document.getElementById("myDropdownSelectIcon").style.display = "none";
                document.getElementById("myDropdownManualIcon").style.display = "none";
                document.getElementById("myDropdownSNMP").style.display = "none";
                document.getElementById("myDropdownRemoteSetting").style.display = "none";
                if (ids != "") {
                    var str = ids + "";
                    if (str == local_id.toString())
                        network.selectNodes([local_mac + "alarm"]);
                    else {
                        if (manual_neighbor_mac.indexOf(str) < 0) {
                            str = str + "alarm";
                            if (!str.includes("alarmalarm"))
                                network.selectNodes([str]);
                        }
                    }
                }
            });


            network.on('oncontext', function (params) {
                ids_right_click = this.getNodeAt(params.pointer.DOM);
                ids_right_click_edge = this.getEdgeAt(params.pointer.DOM);
            });
            
            
            var doubleClickTime = 0;
            var threshold = 500;


            function onRightClick() {
                var str = ids_right_click + "";
                if ((rd == "rd") || (str == local_id.toString())) {
                    document.getElementById("myDropdown").style.display = "none";
                    window.event.returnValue = false;
                    return;
                }
                if (remote_set_processing()) {
                    window.event.returnValue = false;
                    return;
                }
                show_node_menu(ids_right_click, ids_right_click_edge);
                window.event.returnValue = false;
            }
            
            function onClick() {
                var t0 = new Date();
                if (t0 - doubleClickTime > threshold) {
                    setTimeout(function () {
                        if (t0 - doubleClickTime > threshold) {
                            doOnClick();
                        }
                    }, threshold);
                }
            }
            
            function doOnClick() {
                if (remote_set_processing())
                    return;
            }
            
            function onDoubleClick() {
                if (remote_set_processing())
                    return;
                var str = ids + "";
                if (str == local_id.toString()) {
                    //var url = '';
                    //if (rd == "rd")
                    //    url = '/index2.html';
                    //else
                    //    url = '/webctrl.cgi?action=cgi_home_page&csrf_token=' + csrf_token;
                    //window.location.href = url;
                } else {
                    var mac_tmp = "" + ids;
                    var j = neighbor_mac_tmp.indexOf(mac_tmp);
                    if (j >= 0) {
                        if (neighbor_ip_tmp[j]) {
                            var url = 'http://' + neighbor_ip_tmp[j];
                            //window.location.href = url;
                            window.open(url, '_blank');
                        }
                    }
                    j = manual_neighbor_mac.indexOf(mac_tmp);
                    if (j >= 0) {
                        if (manual_neighbor_ip[j] != "0.0.0.0") {
                            var url = 'http://' + manual_neighbor_ip[j];
                            //window.location.href = url;
                            window.open(url, '_blank');
                        }
                    }
                }
            }
           
            network.on('click', onClick);
            
            network.on('doubleClick', onDoubleClick);
            
            network.on('oncontext', onRightClick);
            
            /*
                        network.on("zoom",function() {
                                   if (remote_set_processing())
                                                   return;
                                               document.getElementById("myDropdownSetIP").style.display="none";
                                               document.getElementById("myDropdownReboot").style.display="none";
                                               document.getElementById("myDropdownFactoryDefault").style.display="none";
                                               document.getElementById("myDropdownSave").style.display="none";
                                               document.getElementById("myDropdownChangeIcon").style.display="none";
                                               document.getElementById("myDropdown").style.display="none";
                                        document.getElementById("myDropdownLiteManagementSet").style.display="none";
                                        document.getElementById("myDropdownLiteManagementSet_PoE").style.display="none";
                                        document.getElementById("myDropdownLiteManagement").style.display="none";
                                        document.getElementById("myDropdownLiteManagement_PoE").style.display="none";
                                        document.getElementById("myDropdownLiteManagementOnly").style.display="none";
                                        document.getElementById("myDropdownLiteManagementOnly_PoE").style.display="none";
                                               document.getElementById("myDropdownAddIcon").style.display="none";
                                               document.getElementById("myDropdownEditIcon").style.display="none";
                                               document.getElementById("myDropdownMoveEdge").style.display="none";
                                               document.getElementById("myDropdownSelectIcon").style.display="none";
                            var check_position = 0;
                            if (network.getScale() <= 0.49 ) {
                                network.moveTo({
                                position: {x:0, y:0},
                                    scale: 0.49,
                                });
                                check_position = 1;
                            }
                            if (network.getScale() >= 2.00 ) {
                                network.moveTo({
                                    position: {x:0, y:0},
                                    scale: 2.00,
                                });
                                check_position = 1;
                            }
                            if (check_position == 0) {
                                zoom_position = network.getViewPosition();
                                scale_global = network.getScale();
                            }
                        });
            */
            
            network.on("dragStart", function (params) {
                //console.log("dragStart: "+this.getNodeAt(params.pointer.DOM));
                document.getElementById("myDropdownSetIP").style.display = "none";
                document.getElementById("myDropdownReboot").style.display = "none";
                document.getElementById("myDropdownFactoryDefault").style.display = "none";
                document.getElementById("myDropdownSave").style.display = "none";
                document.getElementById("myDropdownChangeIcon").style.display = "none";
                document.getElementById("myDropdownChangeIconOnly").style.display = "none";
                document.getElementById("myDropdown").style.display = "none";
                document.getElementById("myDropdownLiteManagementSet").style.display = "none";
                document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
                document.getElementById("myDropdownLiteManagement").style.display = "none";
                document.getElementById("myDropdownLiteManagement_PoE").style.display = "none";
                document.getElementById("myDropdownLiteManagementOnly").style.display = "none";
                document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "none";
                document.getElementById("myDropdownAddIcon").style.display = "none";
                document.getElementById("myDropdownEditIcon").style.display = "none";
                document.getElementById("myDropdownMoveEdge").style.display = "none";
                document.getElementById("myDropdownSelectIcon").style.display = "none";
                document.getElementById("myDropdownManualIcon").style.display = "none";
                document.getElementById("myDropdownSNMP").style.display = "none";
                document.getElementById("myDropdownRemoteSetting").style.display = "none";
                var str = this.getNodeAt(params.pointer.DOM);
                if (str != null) {
                    if (str == local_id)
                        str = local_mac;
                    if (!str.includes("alarm")) {
                        if (lock_state) {
                            //if ((str!=local_mac)&&(lock_neighbor_mac.indexOf(str) == -1))
                            if (1)
                                nodes.update({ id: str + "alarm", hidden: true });
                            else
                                network.selectNodes([str + "alarm"]);
                        }
                    }
                }
            });
            
            /*
                        network.on("dragging",function (params) {
                            //console.log("dragging:"+this.getNodeAt(params.pointer.DOM));
                                   });
            */
            
            network.on("dragEnd", function (params) {
                //console.log("dragEnd:"+this.getNodeAt(params.pointer.DOM));
                if (lock_state) {
                    var node_id = this.getNodeAt(params.pointer.DOM);
                    if (node_id != null) {
                        if (node_id == local_id) {
                            /*
                            var node_lock_x_axis = eval("document.lldp_lock_neighbor_xy.x"+local_mac);
                            var node_lock_y_axis = eval("document.lldp_lock_neighbor_xy.y"+local_mac);
                            if ((node_lock_x_axis != null)&&(node_lock_y_axis != null))
                            {
                                nodes.update({x: node_lock_x_axis, y: node_lock_y_axis, id: local_id});
                                    if (local_alarm_info)
                                    {
                                    nodes.update({x: node_lock_x_axis+host_alarm_image_offset_x, y: node_lock_y_axis+host_alarm_image_offset_y, id: local_mac+"alarm", image: alert_img_str});
                                    network.selectNodes([local_mac+"alarm"]);
                                }
                            }
                            */
                            var positions = network.getPositions(node_id);
                            var x_axis = positions[node_id].x;
                            var y_axis = positions[node_id].y;
                            nodes.update({ x: x_axis + host_alarm_image_offset_x, y: y_axis + host_alarm_image_offset_y, fixed: true, id: local_mac + "alarm", hidden: false });
                            network.selectNodes([local_mac + "alarm"]);
                        }
                        else {
                            if (!node_id.includes("alarm")) {
                                //if (lock_neighbor_mac.indexOf(node_id) >= 0)
                                if (0) {
                                    var node_lock_x_axis = eval("document.lldp_lock_neighbor_xy.x" + node_id);
                                    var node_lock_y_axis = eval("document.lldp_lock_neighbor_xy.y" + node_id);
                                    if ((node_lock_x_axis != null) && (node_lock_y_axis != null)) {
                                        nodes.update({ x: node_lock_x_axis, y: node_lock_y_axis, id: node_id });
                                        i = neighbor_mac_tmp.indexOf(node_id);
                                        if (i >= 0) {
                                            if (neighbor_alarm_info_tmp[i]) {
                                                if (neighbor_mac_tmp.indexOf(node_id) >= 0) {
                                                    nodes.update({ x: node_lock_x_axis + alarm_image_offset_x, y: node_lock_y_axis + alarm_image_offset_y, id: node_id + "alarm", image: alert_img_str });
                                                    network.selectNodes([node_id + "alarm"]);
                                                }
                                            }
                                        }
                                    }
                                }
                                else {
                                    var positions = network.getPositions(node_id);
                                    var x_axis = positions[node_id].x;
                                    var y_axis = positions[node_id].y;
                                    nodes.update({ x: x_axis + alarm_image_offset_x, y: y_axis + alarm_image_offset_y, fixed: true, id: node_id + "alarm", hidden: false });
                                    network.selectNodes([node_id + "alarm"]);
                                }
                            }
                        }
                    }
                }
                network.moveTo({
                    position: { x: 0, y: 0 },
                    scale: scale_global,
                });
                /*
                                network.fit();
                */
            });
            
            
            //            network.fit();
            //setTimeout('close_physics()',1000);


            neighbor_mac_tmp = neighbor_mac;
            neighbor_alarm_info_tmp = neighbor_alarm_info;
            neighbor_multicast_remote_set_tmp = neighbor_multicast_remote_set;
            neighbor_ip_tmp = neighbor_ip;
        }
        
        
        //createNetwork("easeInCubic");

        
        function close_physics() {
            var options = {
                physics: {
                    enabled: false,
                },
            };
            network.setOptions(options);
            //network.fit();
        }

        function updateEdges() {
            if (lock_state) {
                var x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + local_mac);
                var y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + local_mac);
                if ((x_axis_tmp != null) && (y_axis_tmp != null)) {
                    nodes.update({ x: x_axis_tmp, y: y_axis_tmp, id: local_id });
                    nodes.update({ x: x_axis_tmp + host_alarm_image_offset_x, y: y_axis_tmp + host_alarm_image_offset_y, id: local_mac + "alarm" });
                }
                for (i = 0; i < neighbor_mac.length; i++) {
                    if (lock_neighbor_mac.indexOf(neighbor_mac[i]) >= 0) {
                        var x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + neighbor_mac[i]);
                        var y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + neighbor_mac[i]);
                        if ((x_axis_tmp != null) && (y_axis_tmp != null)) {
                            nodes.update({ x: x_axis_tmp, y: y_axis_tmp, id: neighbor_mac[i] });
                            nodes.update({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: neighbor_mac[i] + "alarm" });
                            network.selectNodes([neighbor_mac[i] + "alarm"]);
                        }
                    }
                    else {
                        var positions = network.getPositions(neighbor_parent_id[i]);
                        var x_axis = positions[neighbor_parent_id[i]].x + (neighbor_with_host_port[i] * 50);
                        if (neighbor_with_host_port[i] == -1)
                            x_axis = positions[neighbor_parent_id[i]].x + 50;
                        var y_axis = positions[neighbor_parent_id[i]].y + 100;
                        nodes.update({ x: x_axis, y: y_axis, id: neighbor_mac[i] });
                    }
                }
                for (i = 0; i < lock_neighbor_mac.length; i++) {
                    if (neighbor_mac.indexOf(lock_neighbor_mac[i]) == -1) {
                        var x_axis_tmp = eval("document.lldp_lock_neighbor_xy.x" + lock_neighbor_mac[i]);
                        var y_axis_tmp = eval("document.lldp_lock_neighbor_xy.y" + lock_neighbor_mac[i]);
                        if ((x_axis_tmp != null) && (y_axis_tmp != null)) {
                            nodes.update({ x: x_axis_tmp, y: y_axis_tmp, id: lock_neighbor_mac[i] });
                            nodes.update({ x: x_axis_tmp + alarm_image_offset_x, y: y_axis_tmp + alarm_image_offset_y, id: lock_neighbor_mac[i] + "alarm" });
                            //network.selectNodes([lock_neighbor_mac[i]+"alarm"]);
                        }
                    }
                }
            }
            for (i = 0; i < neighbor_mac.length; i++) {
                if (neighbor_mac[i]) {
                    if ((lock_state) && (neighbor_alarm_info[i])) {
                        var positions = network.getPositions(neighbor_mac[i]);
                        var x_axis = positions[neighbor_mac[i]].x;
                        var y_axis = positions[neighbor_mac[i]].y;
                        nodes.update({ x: x_axis + alarm_image_offset_x, y: y_axis + alarm_image_offset_y, fixed: true, id: neighbor_mac[i] + "alarm", image: alert_img_str });
                        network.selectNodes([neighbor_mac[i] + "alarm"]);
                    }
                    edges.update({ id: "to" + neighbor_mac[i], from: neighbor_parent_id[i], to: neighbor_mac[i] });
                }
            }
            for (i = 0; i < manual_neighbor_mac.length; i++) {
                if (manual_neighbor_mac[i]) {
                    edges.update({ id: "to" + manual_neighbor_mac[i], from: manual_neighbor_parent_id[i], to: manual_neighbor_mac[i] });
                }
            }
            if (lock_state) {
                for (i = 0; i < lock_neighbor_mac.length; i++) {
                    if (neighbor_mac.indexOf(lock_neighbor_mac[i]) == -1) {
                        if (lock_neighbor_mac[i]) {
                            edges.update({ id: "to" + lock_neighbor_mac[i], from: lock_neighbor_parent_id[i], to: lock_neighbor_mac[i] });
                        }
                    }
                }
            }
            for (i = 0; i < move_neighbor_mac.length; i++) {
                if (move_neighbor_mac[i]) {
                    edges.update({ id: "to" + move_neighbor_mac[i], from: move_neighbor_parent_id[i], to: move_neighbor_mac[i] });
                }
            }
            if (label_state == 1) {
                //document.getElementById("show_label_btn").value = "Show Label";
                document.getElementById("show_label_btn").checked = false;
                show_label();
            }
            show_edges();
        }

        function updateEdgesToUnlock() {
            nodes.update({ id: local_id, fixed: false });
            nodes.update({ id: local_mac + "alarm", image: empty_img_str });
            for (i = 0; i < neighbor_mac_tmp.length; i++) {
                if (neighbor_mac_tmp[i]) {
                    nodes.update({ id: neighbor_mac_tmp[i], fixed: false });
                    nodes.update({ id: neighbor_mac_tmp[i] + "alarm", image: empty_img_str });
                    edges.update({ id: neighbor_mac_tmp[i] + "to", color: { color: '#000000', highlight: '#000000' } });
                    edges.update({ id: "to" + neighbor_mac_tmp[i], color: { color: '#000000', highlight: '#000000', opacity: 0 } });
                }
            }
            for (i = 0; i < lock_neighbor_mac.length; i++) {
                if (neighbor_mac_tmp.indexOf(lock_neighbor_mac[i]) == -1) {
                    nodes.update({ id: lock_neighbor_mac[i], hidden: true });
                    nodes.update({ id: lock_neighbor_mac[i] + "alarm", image: empty_img_str });
                    edges.update({ id: lock_neighbor_mac[i] + "to", hidden: true });
                    edges.update({ id: "to" + lock_neighbor_mac[i], hidden: true });
                }
            }
            for (i = 0; i < manual_neighbor_mac.length; i++) {
                if (manual_neighbor_mac[i]) {
                    nodes.update({ id: manual_neighbor_mac[i], fixed: false });
                    nodes.update({ id: manual_neighbor_mac[i] + "alarm", image: empty_img_str });
                    edges.update({ id: manual_neighbor_mac[i] + "to", color: { color: '#0000FF', highlight: '#0000FF' } });
                    edges.update({ id: "to" + manual_neighbor_mac[i], color: { color: '#0000FF', highlight: '#0000FF', opacity: 0 } });
                }
            }
            document.getElementById("Unlock_Map").disabled = true;
            document.getElementById("Unlock_Map").src = "images/unlock_disable.png";
            //document.getElementById("Lock_Map").disabled=false;
            //document.getElementById("Lock_Map").value = "Lock Map";
            document.getElementById("Lock_Map").title = "Lock Map";
            document.getElementById("select_style").options[1].disabled = false
            document.getElementById("select_style").options[2].disabled = false
            //document.getElementById("Style_STAR").disabled = false;
            //document.getElementById("Style_LEVEL").disabled = false;
        }

        function updateLearningNetwork() {
            var i, j, k;
            var edges_color;
            var edge_label;
            var html_title = "<table>";
            html_title += "<tr><td>IP Address</td><td>" + local_ip + "</td></tr>";
            html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(local_mac) + "</td></tr>";
            html_title += "<tr><td>Product Name</td><td>" + local_product_name + "</td></tr>";
            html_title += "<tr><td>System Name</td><td>" + local_system_name + "</td></tr>";
            html_title += "</table>";
            nodes.update({ id: 1, shape: 'image', size: 60, title: html_title, image: ('ems_images/' + local_product_name + '-unknown.gif'), font: { size: 12 } });
            for (i = 0; i < port_state.length; i++) {
                j = i + 2;  // Topology map nodes ID
                var port_id = i + 1;
                if ((port_state[i] == 1) || (learning_port_configuration_state[i] == 1)) {
                    var img_str;
                    if (neighbor_product_name[i]) {
                        if (ems_images_model_name.indexOf(neighbor_product_name[i]) >= 0) {
                            img_str = 'ems_images/' + neighbor_product_name[i] + '-unknown.gif';
                        } else {
                            img_str = 'ems_images/generic-unknown.gif';
                        }
                    } else {
                        img_str = 'ems_images/generic-unknown.gif';
                    }
                    edges_color = edges_default_color;
                    html_title = "<table>";
                    if (port_state[i] == 1) {
                        if (neighbor_ip[i] == "0.0.0.0")
                            html_title += "<tr><td>IP Address</td><td>-</td></tr>";
                        else
                            html_title += "<tr><td>IP Address</td><td>" + neighbor_ip[i] + "</td></tr>";
                        html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(neighbor_mac[i]) + "</td></tr>";
                        if (netlite_type.indexOf(neighbor_product_name[i]) >= 0) {
                            html_title += "<tr><td>Product Name</td><td>" + neighbor_product_name_netlite[i] + "</td></tr>";
                        } else {
                            html_title += "<tr><td>Product Name</td><td>" + neighbor_product_name[i] + "</td></tr>";
                        }
                        html_title += "<tr><td>System Name</td><td>" + neighbor_system_name[i] + "</td></tr>";
                    } else {
                        if (ems_images_model_name.indexOf(learning_neighbor_product_name[i]) >= 0) {
                            img_str = 'ems_images/' + learning_neighbor_product_name[i] + '-unknown.gif';
                        }
                        if (learning_neighbor_ip[i] == "0.0.0.0")
                            html_title += "<tr><td>IP Address</td><td>-</td></tr>";
                        else
                            html_title += "<tr><td>IP Address</td><td>" + learning_neighbor_ip[i] + "</td></tr>";
                        html_title += "<tr><td>MAC Address</td><td>" + mac12_to_mac17(learning_neighbor_mac[i]) + "</td></tr>";
                        if (netlite_type.indexOf(learning_neighbor_product_name[i]) >= 0) {
                            html_title += "<tr><td>Product Name</td><td>" + learning_neighbor_product_name_netlite[i] + "</td></tr>";
                        } else {
                            html_title += "<tr><td>Product Name</td><td>" + learning_neighbor_product_name[i] + "</td></tr>";
                        }
                        html_title += "<tr><td>System Name</td><td>" + learning_neighbor_system_name[i] + "</td></tr>";
                    }
                    html_title += "<tr><td>Host Port #</td><td>" + port_id + "</td></tr>";
                    html_title += "</table>";
                    var edge_html_title = "<table>";
                    var color_index = 0;
                    var status_flag = 0;
                    if (port_blocking_status[i] > 0) {
                        var offset = 1;
                        var result_index = -1;
                        for (k = 0; k < port_blocking_status_list.length; k++) {
                            if (port_blocking_status_list[k][0] == port_blocking_status[i]) {
                                result_index = k;
                                break;
                            }
                        }
                        if (result_index != -1) {
                            var status_messeage = port_blocking_status_list[result_index][offset];
                            if (port_blocking_status[i] < 256) {
                                color_index += 100;
                                edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FF0000\">" + status_messeage + "</td></tr>";
                            } else {
                                color_index++;
                                edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FABF22\">" + status_messeage + "</td></tr>";
                            }
                        }
                        if (learning_port_configuration_flag == 1) {
                            if (learning_port_configuration_state[i] == 0) {
                                color_index++;
                                edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FABF22\">Yet Registered</td></tr>";
                                status_flag++;
                            } else {
                                if (learning_neighbor_mac[i] != neighbor_mac[i]) {
                                    color_index++;
                                    edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FABF22\">Yet Registered</td></tr>";
                                    status_flag++;
                                }
                            }
                        }
                    } else {
                        if (port_state[i] == 0) {
                            color_index += 100;
                            edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FF0000\">Link Down</td></tr>";
                            status_flag++;
                        } else {
                            if (learning_port_configuration_flag == 1) {
                                if (learning_port_configuration_state[i] == 0) {
                                    color_index++;
                                    edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FABF22\">Yet Registered</td></tr>";
                                    status_flag++;
                                } else {
                                    if (learning_neighbor_mac[i] != neighbor_mac[i]) {
                                        color_index++;
                                        edge_html_title += "<tr><td>Status</td><td bgcolor=\"#FABF22\">Yet Registered</td></tr>";
                                        status_flag++;
                                    }
                                }
                            }
                        }
                        if (status_flag == 0) {
                            edge_html_title += "<tr><td>Status</td><td>Link Up</td></tr>";
                        }
                    }
                    if ((port_state[i] == 1) && (learning_port_configuration_flag == 1)) {
                        if (learning_port_speed[i] != port_speed[i]) {
                            color_index++;
                            edge_html_title += "<tr><td>Speed</td><td bgcolor=\"#FABF22\">" + port_speed[i] + "Mbps (Reg: " + learning_port_speed[i] + "Mbps)</td></tr>";
                        } else {
                            edge_html_title += "<tr><td>Speed</td><td>" + port_speed[i] + "Mbps</td></tr>";
                        }
                    }
                    if (port_state[i] == 1) {
                        var cmp_1 = (port_tx_data[i] / 100) * 100;
                        if (cmp_1 >= tx_u_color_threshold_red[i]) {
                            color_index += 100;
                            edge_html_title += "<tr><td>Transmitting Port Usage</td><td bgcolor=\"#FF0000\">" + port_tx_data[i] + "%</td></tr>";
                        } else if (cmp_1 >= tx_u_color_threshold_yellow[i]) {
                            color_index++;
                            edge_html_title += "<tr><td>Transmitting Port Usage</td><td bgcolor=\"#FABF22\">" + port_tx_data[i] + "%</td></tr>";
                        } else {
                            edge_html_title += "<tr><td>Transmitting Port Usage</td><td bgcolor=\"#269B30\">" + port_tx_data[i] + "%</td></tr>";
                        }
                        var cmp_2 = (port_rx_data[i] / 100) * 100;
                        if (cmp_2 >= rx_u_color_threshold_red[i]) {
                            color_index += 100;
                            edge_html_title += "<tr><td>Receiving Port Usage</td><td bgcolor=\"#FF0000\">" + port_rx_data[i] + "%</td></tr>";
                        } else if (cmp_2 >= rx_u_color_threshold_yellow[i]) {
                            color_index++;
                            edge_html_title += "<tr><td>Receiving Port Usage</td><td bgcolor=\"#FABF22\">" + port_rx_data[i] + "%</td></tr>";
                        } else {
                            edge_html_title += "<tr><td>Receiving Port Usage</td><td bgcolor=\"#269B30\">" + port_rx_data[i] + "%</td></tr>";
                        }
                    }
                    var tmp_img_str;
                    if (color_index >= 100) {
                        edges_color = edges_red;
                        //tmp_img_str = img_str.replace("-unknown.gif", "-critical.gif");
                        //edge_label = 'X';
                    } else if (color_index >= 1) {
                        edges_color = edges_yellow;
                        //tmp_img_str = img_str.replace("-unknown.gif", "-alert.gif");
                        //edge_label = '!';
                    } else {
                        //tmp_img_str = img_str.replace("-unknown.gif", "-stable.gif");
                        //edge_label = 'O';
                    }
                    edges_font_color = edges_color;
                    //img_str = tmp_img_str;

                    if (neighbor_device_state[i] == 1 && neighbor_device_image[i] != "")
                        img_str = 'ems_images/' + neighbor_device_image[i];

                    edge_html_title += "<tr><td>Host Port #</td><td>" + port_id + "</td></tr>";
                    edge_html_title += "</table>";
                    nodes.update({ id: j, shape: 'image', size: 40, title: html_title, image: img_str, font: { size: 12 } });
                    edges.update({ id: j, from: 1, to: j, length: 225, title: edge_html_title, label: edge_label, font: { color: edges_font_color, strokeWidth: 2, strokeColor: edges_color, size: 60 }, color: { color: edges_color, highlight: edges_color } });
                } else {
                    nodes.remove(j);
                    edges.remove(j);
                }
            }
        }


        // ------------------------------------------------
        
        // 跟背景有關ㄉ

        function page_background_change() {
            var table_body = document.getElementById("table_body");  // 就是在說body
            if (ems_radio_type == 0) {
                table_body.style.backgroundColor = "#FFFFFF";
                table_body.style.backgroundImage = "url(ems_images/" + ems_page_image + ")";
                table_body.style.backgroundAttachment = "fixed";
                table_body.style.backgroundSize = "100%";
            }
            else if (ems_radio_type == 1) {
                table_body.style.backgroundColor = ems_page_color;
                table_body.style.backgroundImage = "";
            }
        }

        // ------------------------------------------------


        function myRefresh() {
            /*
                        if (color_threshold_flag == 1) {
                            reload_js('color_threshold.js');
                            tx_u_color_threshold_yellow.fill(port_txu_color_threshold_yellow_data);
                            tx_u_color_threshold_red.fill(port_txu_color_threshold_red_data);
                            rx_u_color_threshold_yellow.fill(port_rxu_color_threshold_yellow_data);
                            rx_u_color_threshold_red.fill(port_rxu_color_threshold_red_data);
                        } else {
                            tx_u_color_threshold_yellow = [60,60,60,60,60,60,60,60,60,60];
                            tx_u_color_threshold_red = [80,80,80,80,80,80,80,80,80,80];
                            rx_u_color_threshold_yellow = [60,60,60,60,60,60,60,60,60,60];
                            rx_u_color_threshold_red = [80,80,80,80,80,80,80,80,80,80];
                        }
                        if (learning_port_configuration_flag == 1) {
            */
            if (0) {
                reload_js('learning_port_configuration.js');
                learning_port_configuration_state = port_state;
                learning_port_speed = port_speed;
                reload_js('quick_diagnosis_dashboard.js');
                reload_js('learning_lldp_neighbor.js');
                learning_neighbor_product_name = neighbor_product_name;
                learning_neighbor_system_name = neighbor_system_name;
                learning_neighbor_ip = neighbor_ip;
                learning_neighbor_mac = neighbor_mac;
                reload_js('lldp_neighbor.js');
                updateLearningNetwork();
            } else {
                //reload_js('lldp_neighbor.js');
                //reload_js('learning_port_init.js');
                //reload_js('quick_diagnosis_dashboard.js');
                if (0) {
                    reload_js('lldp_ems_images.js');
                    reload_js('lldp_init_neighbor.js');
                    reload_js('lldp_lock_neighbor.js');
                    reload_js('lldp_lock_neighbor_xy.js');
                    reload_js('lldp_new_neighbor.js');
                }
                if ((lldp_init_neighbor_ready) && (lldp_neighbor_ready) && (lldp_lock_neighbor_ready)) {
                    if ((current_topology_style != topology_style) || (current_lock_state != lock_state)) {
                        if (getCookie('ems_not_reload') == "1")
                            updateNetwork();
                        else
                            location.reload();
                    }
                    else {
                        deleteCookie('ems_not_reload');
                        updateNetwork();
                    }
                }
            }
            //network.fit();
            //page_background_change();
        }
        //myRefresh();
        //setInterval('myRefresh()',3000);

        function local_refresh() {
            updateNetwork();
        }

        var filter_mac = "";
        function filter_device(obj) {
            filter_mac = obj.value;
            let focus_x = 0, focus_y = 0;
            let find_mac_index = -1;
            nodesArray.forEach((item, index) => {
                if (item.id == filter_mac) {
                    //nodes.update({ id: item.id, size: 80});
                    nodes.update({ id: item.id, size: 80, imagePadding: 10, shapeProperties: { useBorderWithImage: true }, color: { background: '#FFD9EC', border: '#28FF28' } });
                    //nodes.update({ id: '000b0414599e', size: 80, image: "ems_images/SEN-8425PL-unknown.gif", imagePadding: {left: 100,top: 100,bottom: 100,right: 100 }, shapeProperties: {useBorderWithImage: true }, color:{background:'red',border:'blue'}});
                    focus_x = eval("document.lldp_lock_neighbor_xy.x" + item.id);
                    focus_y = eval("document.lldp_lock_neighbor_xy.y" + item.id);
                }
                else {
                    find_mac_index = neighbor_mac.findIndex(element => element == item.id);
                    //只處理node是mac的資料
                    if (find_mac_index > -1) {
                        nodes.update({ id: item.id, size: 40, shapeProperties: { useBorderWithImage: false } });
                        //nodes.update({ id: neighbor_mac[find_mac_index], size: 40 ,imagePadding:0,shapeProperties: {useBorderWithImage: false }});
                    }
                }
            });

            network.moveTo({
                position: { x: focus_x, y: focus_y }
            });

        }

        function clear_filter() {
            filter_mac = '';
            document.getElementById("input_filter_device").value = '';
            nodesArray.forEach((item, index) => {
                let find_mac_index = neighbor_mac.findIndex(element => element == item.id);
                if (find_mac_index > -1) {
                    nodes.update({ id: neighbor_mac[find_mac_index], size: 40, shapeProperties: { useBorderWithImage: false } });
                }
            });

            network.moveTo({
                position: { x: 0, y: 0 }
            });

        }

        function set_edges_style(topology_style) {
            if (remote_set_processing())
                return;
            setCookie('ems_not_reload', '1', 365);
            //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_topology_set' + rd + '11' + topology_style + lock_state + label_state + edges_state + '&csrf_token=' + csrf_token;
            document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_topology_set?data=' + topology_style + lock_state + label_state + edges_state + '&csrf_token=' + csrf_token;

        }

        function show_edges() {
            if (remote_set_processing())
                return;
            var color_opacity = 0;
            if (edges_state) {
                //document.getElementById("show_edges_btn").value = "Hide Edges";
                document.getElementById("show_edges_btn").checked = true;
                //.removeAttribute('checked');
                color_opacity = 30;
            }
            else {
                //document.getElementById("show_edges_btn").value = "Show Edges";
                document.getElementById("show_edges_btn").checked = false;
                color_opacity = 0;
            }
            for (i = 0; i < neighbor_mac.length; i++) {
                var edge = edges.get(neighbor_mac[i] + "to");
                edges.update({ id: neighbor_mac[i] + "to", color: { color: edge.color.color, highlight: edge.color.color, opacity: color_opacity } });
            }
            if (lock_state) {
                for (i = 0; i < lock_neighbor_mac.length; i++) {
                    var edge = edges.get(lock_neighbor_mac[i] + "to");
                    edges.update({ id: lock_neighbor_mac[i] + "to", color: { color: edge.color.color, highlight: edge.color.color, opacity: color_opacity } });
                }
            }
            for (i = 0; i < manual_neighbor_mac.length; i++) {
                if (neighbor_mac.indexOf(manual_neighbor_mac[i]) >= 0)
                    break;
                var edge = edges.get(manual_neighbor_mac[i] + "to");
                edges.update({ id: manual_neighbor_mac[i] + "to", color: { color: edge.color.color, highlight: edge.color.color, opacity: color_opacity } });
            }
        }

        function show_label() {
            if (remote_set_processing())
                return;
            if (document.getElementById("show_label_btn").checked) {
                label_state = 1;
                //document.getElementById("show_label_btn").value = "Hide Label";
                network.setOptions({
                    edges: {
                        scaling: {
                            label: {
                                maxVisible: 30,
                            },
                        },
                    },
                });
            }
            else {
                label_state = 0;
                //document.getElementById("show_label_btn").value = "Show Label";
                network.setOptions({
                    edges: {
                        scaling: {
                            label: {
                                maxVisible: 0,
                            },
                        },
                    },
                });
            }
        }
        //setCookie('positions_enable','0',365);
        //if (parseInt(getCookie('positions_enable'), 10)==1)
        function unlock_positions() {
            if (rd == "rd")
                return;
            if (remote_set_processing())
                return;
            lock_state = 0;
            setCookie('ems_not_reload', '1', 365);
            document.getElementById("Unlock_Map").disabled = true;
            document.getElementById("Unlock_Map").src = "images/unlock_disable.png";
            //document.getElementById("Lock_Map").disabled=true;
            document.getElementById("select_style").options[1].disabled = true
            document.getElementById("select_style").options[2].disabled = true
            //document.getElementById("Style_STAR").disabled = true;
            //document.getElementById("Style_LEVEL").disabled = true;
            setCookie('positions_enable', '0', 365);

            //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_topology_set' + rd + '11' + topology_style + lock_state + label_state + edges_state + '&csrf_token=' + csrf_token;
            document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_topology_set?data=' + topology_style + lock_state + label_state + edges_state + '&csrf_token=' + csrf_token;
            edges_state = 1
            //document.getElementById("show_edges_btn").value = "Hide Edges";
            document.getElementById("show_edges_btn").checked = true;
        }
        function save_positions() {
            if (rd == "rd")
                return;
            if (remote_set_processing())
                return;
            var org_lock_state = lock_state;
            lock_state = 1;
            setCookie('ems_not_reload', '1', 365);
            document.getElementById("Unlock_Map").disabled = true;
            document.getElementById("Unlock_Map").src = "images/unlock_disable.png";
            document.getElementById("Lock_Map").disabled = true;
            document.getElementById("Lock_Map").src = "images/lock_disable.png";
            document.getElementById("select_style").options[1].disabled = true
            document.getElementById("select_style").options[2].disabled = true
            //document.getElementById("Style_STAR").disabled = true;
            //document.getElementById("Style_LEVEL").disabled = true;
            setCookie('positions_enable', '1', 365);
            //document.topology_set.location.href = 'webctrl.cgi?action=cgi_ems_topology_set' + rd + '11' + topology_style + lock_state + label_state + edges_state + '&csrf_token=' + csrf_token;
            document.topology_set.location.href = '/webctrl/TopologyMap/cgi_ems_topology_set?data=' + topology_style + lock_state + label_state + edges_state + '&csrf_token=' + csrf_token;
            //console.log("submit_lock_info");
            document.topology_lock.submit_lock_info(org_lock_state);
            //current_lock_state=lock_state;
        }
        function SetManualMap() {
            network.setOptions({
                layout: {
                    hierarchical: {
                        enabled: false,
                    }
                },
            });
            network.setOptions({
                physics: {
                    enabled: false,
                },
            });
            updateEdges();
            network_draw_ready = 1;
            document.getElementById("Reload_Page").disabled = false;
            if (lock_state) {
                //parent.document.getElementById("Lock_Map").value = "Re-Lock Map";
                parent.document.getElementById("Lock_Map").title = "Re-Lock Map";
                document.getElementById("Lock_Map").disabled = false;
                document.getElementById("Lock_Map").src = "images/lock.png";
                document.getElementById("Unlock_Map").disabled = false;
                document.getElementById("Unlock_Map").src = "images/unlock.png";
                document.getElementById("select_style").options[1].disabled = true;
                document.getElementById("select_style").options[2].disabled = true;
                //document.getElementById("Style_STAR").disabled = true;
                //document.getElementById("Style_LEVEL").disabled = true;
            }
            else {
                //parent.document.getElementById("Lock_Map").value = "Lock Map";
                document.getElementById("Lock_Map").disabled = false;
                parent.document.getElementById("Lock_Map").title = "Lock Map";
                document.getElementById("Lock_Map").src = "images/lock.png";
                if (topology_style == 1) {
                    document.getElementById("select_style").options[1].disabled = false;
                    document.getElementById("select_style").options[2].disabled = true;
                    //document.getElementById("Style_STAR").disabled = false;
                    //document.getElementById("Style_LEVEL").disabled = true;
                }
                else {
                    document.getElementById("select_style").options[1].disabled = true;
                    document.getElementById("select_style").options[2].disabled = false;
                    //document.getElementById("Style_STAR").disabled = true;
                    //document.getElementById("Style_LEVEL").disabled = false;
                }
            }
            document.getElementById("show_label_btn").disabled = false;
            document.getElementById("show_edges_btn").disabled = false;
            document.getElementById("Zoom_In").disabled = false;
            document.getElementById("Zoom_Out").disabled = false;

            if (zoom_current != 100) {
                zoom_current = parseInt(zoom_current, 10) - 10;
                setTimeout('zoom_in()', 100);
            }
        }

    </script>
    <script>
        function start_createNetwork() {
            //console.log("lock_state="+lock_state);
            createNetwork("easeInCubic");
            if (rd == "rd")
                setTimeout("document.topology_update.location.href='topology_update.htm';", 10000);
            else {
                setTimeout("document.topology_lock.location.href='topology_lock.htm?csrf_token=" + csrf_token + "';", 1000);
                if (demo)
                    setTimeout("document.topology_update.location.href='topology_update.htm?r=2&csrf_token=" + csrf_token + "';", 10000);
                else
                    setTimeout("document.topology_update.location.href='topology_update.htm?r=0&csrf_token=" + csrf_token + "';", 10000);
            }
            if (lock_state) {
                document.getElementById("Unlock_Map").disabled = false;
                document.getElementById("Unlock_Map").src = "images/unlock.png";
                //document.getElementById("Lock_Map").disabled=true;
                document.getElementById("select_style").options[1].disabled = true;
                document.getElementById("select_style").options[2].disabled = true;
                //document.getElementById("Style_STAR").disabled = true;
                //document.getElementById("Style_LEVEL").disabled = true;
            }
            else {
                document.getElementById("Unlock_Map").disabled = true;
                document.getElementById("Unlock_Map").src = "images/unlock_disable.png";
                //document.getElementById("Lock_Map").disabled=true;
                document.getElementById("select_style").options[1].disabled = false;
                document.getElementById("select_style").options[2].disabled = false;
                //document.getElementById("Style_STAR").disabled=false;
                //document.getElementById("Style_LEVEL").disabled=false;
            }
            //network.once('stabilized', function() {
            //    var scaleOption = { scale : 1 };
            //    network.moveTo(scaleOption);
            //})
            network.setOptions({
                edges: {
                    scaling: {
                        label: {
                            maxVisible: 0,
                        },
                    },
                },
            });
            org_width = document.getElementById("mynetwork").clientWidth;
            org_height = document.getElementById("mynetwork").clientHeight;
            document.getElementById("size_scale").value = "" + zoom_current + "% of " + org_width + "x" + org_height;
            //alert(org_width+" "+org_height);
            document.getElementById("bg_img").width = org_width;
            document.getElementById("bg_img").height = org_height;
            bg_width = document.getElementById("bg_img").width;
            bg_height = document.getElementById("bg_img").height;
            if (bg_type == 1)//color
            {
                document.getElementById("mynetwork").style.backgroundColor = bg_color;
                document.getElementById("bg_img").src = "images/empty.png";
            }
            else//image
            {
                document.getElementById("select_bg_opacity").selectedIndex = parseInt(selectindex_bg_opacity_current, 10);
                on_select_bg_opacity(document.getElementById("select_bg_opacity"));
                document.getElementById("mynetwork").style.backgroundColor = "";
                document.getElementById("bg_img").src = bg_image;
            }
            if (lock_state)
                SetManualMap();
            else
                setTimeout('SetManualMap()', 1000);

        }

        function getRandomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }

        function load_lldp_ems_images() {

            if (!lldp_ems_images_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_ems_images.location.href = 'lldp_ems_images.htm?v=' + v1 + v2;
                setTimeout("load_lldp_ems_images()", 500);
            }
            else {
                if (map_size_width == 0)
                    map_size_width = canvas_width;
                if (map_size_height == 0)
                    map_size_height = canvas_height;
                document.getElementById("mynetwork").style.width = map_size_width;
                document.getElementById("mynetwork").style.height = map_size_height;
                start_createNetwork();
            }
        }

        function load_lldp_init_topology() {
            if (!lldp_init_topology_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_init_topology.location.href = 'lldp_init_topology.htm?v=' + v1 + v2;
                setTimeout("load_lldp_init_topology()", 500);
            }
            else {
                current_topology_style = topology_style;
                current_lock_state = lock_state;
                load_lldp_ems_images();
            }
        }

        function load_lldp_new_neighbor() {
            if (!lldp_neighbor_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_new_neighbor.location.href = 'lldp_new_neighbor.htm?v=' + v1 + v2;
                setTimeout("load_lldp_new_neighbor()", 500);
            }
            else {
                load_lldp_init_topology();
            }
        }

        function load_lldp_move_neighbor() {
            if (!lldp_move_neighbor_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_move_neighbor.location.href = 'lldp_move_neighbor.htm?v=' + v1 + v2;
                setTimeout("load_lldp_move_neighbor()", 500);
            }
            else {
                load_lldp_new_neighbor();
            }
        }

        function load_lldp_manual_neighbor_ping() {
            if (!lldp_manual_neighbor_ping_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_manual_neighbor_ping.location.href = 'lldp_manual_neighbor_ping.htm?v=' + v1 + v2;
                setTimeout("load_lldp_manual_neighbor_ping()", 500);
            }
            else {
                load_lldp_move_neighbor();
            }
        }

        function load_lldp_manual_neighbor_xy() {
            if (!lldp_manual_neighbor_xy_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_manual_neighbor_xy.location.href = 'lldp_manual_neighbor_xy.htm?v=' + v1 + v2;
                setTimeout("load_lldp_manual_neighbor_xy()", 500);
            }
            else {
                load_lldp_manual_neighbor_ping();
            }
        }

        function load_lldp_manual_neighbor() {
            if (!lldp_manual_neighbor_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_manual_neighbor.location.href = 'lldp_manual_neighbor.htm?v=' + v1 + v2;
                setTimeout("load_lldp_manual_neighbor()", 500);
            }
            else {
                load_lldp_manual_neighbor_xy();
            }
        }

        function load_lldp_lock_neighbor_xy() {
            if (!lldp_lock_neighbor_xy_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_lock_neighbor_xy.location.href = 'lldp_lock_neighbor_xy.htm?v=' + v1 + v2;
                setTimeout("load_lldp_lock_neighbor_xy()", 500);
            }
            else {
                load_lldp_manual_neighbor();
            }
        }

        function load_lldp_lock_neighbor() {
            if (!lldp_lock_neighbor_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_lock_neighbor.location.href = 'lldp_lock_neighbor.htm?v=' + v1 + v2;
                setTimeout("load_lldp_lock_neighbor()", 500);
            }
            else {
                load_lldp_lock_neighbor_xy();
            }
        }

        function close_window() {
            alert("Master function is disabled.")
            window.close();
        }


        // ------------------------------------------------


        // 這邊會把選好的顏色帶回TOPOLOGY頁

        function load_lldp_init_neighbor() {
            if (!lldp_init_neighbor_ready) {
                var v1 = getRandomInt(999);
                var v2 = new Date().getMilliseconds();
                document.lldp_init_neighbor.location.href = 'lldp_init_neighbor.htm?v=' + v1 + v2;
                setTimeout("load_lldp_init_neighbor()", 500);
            }
            else {
                if (master_enabled)
                    load_lldp_lock_neighbor();
                else {
                    close_window();
                }
            }
        }


        // ------------------------------------------------


        function myFunction(event) {
            if (network_draw_ready) {
                //this.style.fontSize = "35px";
                document.getElementById("myDropdownRemoteSetting").style.display = "none";
                document.getElementById("myDropdownSNMP").style.display = "none";
                document.getElementById("myDropdownSetIP").style.display = "none";
                document.getElementById("myDropdownReboot").style.display = "none";
                document.getElementById("myDropdownFactoryDefault").style.display = "none";
                document.getElementById("myDropdownSave").style.display = "none";
                document.getElementById("myDropdownChangeIcon").style.display = "none";
                document.getElementById("myDropdown").style.display = "none";
                document.getElementById("myDropdownLiteManagementSet").style.display = "none";
                document.getElementById("myDropdownLiteManagementSet_PoE").style.display = "none";
                document.getElementById("myDropdownLiteManagement").style.display = "none";
                document.getElementById("myDropdownLiteManagement_PoE").style.display = "none";
                document.getElementById("myDropdownLiteManagementOnly").style.display = "none";
                document.getElementById("myDropdownLiteManagementOnly_PoE").style.display = "none";
                document.getElementById("myDropdownAddIcon").style.display = "none";
                document.getElementById("myDropdownEditIcon").style.display = "none";
                document.getElementById("myDropdownMoveEdge").style.display = "none";
                document.getElementById("myDropdownSelectIcon").style.display = "none";
                if (event.deltaY < 0) {
                    //document.getElementById("mynetwork").style.zoom="50%";
                    //document.body.style.zoom="50%";
                    document.getElementById("mynetwork").style.width = org_width / 2;
                    document.getElementById("mynetwork").style.height = org_height / 2;
                    document.getElementById("bg_img").width = bg_width / 2;
                }
                if (event.deltaY > 0) {
                    //document.getElementById("mynetwork").style.zoom="100%";
                    //document.body.style.zoom="100%";
                    document.getElementById("mynetwork").style.width = org_width;
                    document.getElementById("mynetwork").style.height = org_height;
                    document.getElementById("bg_img").width = bg_width;
                }
            }
        }

        //if (rd=="")
        csrf_token_check();

        load_lldp_init_neighbor();
        //document.body.addEventListener("wheel", myFunction);


        // ------------------------------------------------


        // 填背景色function
        function myFunc(ev) {
            // 把顏色轉成rgb形式 (原先是16進位)
            const color = bg_color.value
            const r = parseInt(bg_color.substr(1, 2), 16);
            const g = parseInt(bg_color.substr(3, 2), 16);
            const b = parseInt(bg_color.substr(5, 2), 16);
            console.log(`${r}, ${g}, ${b}`);


            // options.nodes.color.border = resBgColor(bg_color);
            // options.edges.color = resBgColor(bg_color);
            // options.nodes.color.highlight.border = resBgColor(bg_color);
            // options.nodes.color.highlight.background = "#ffffff";

            network = new vis.Network(container, data, options);
        }

        // 判斷背景顏色深淺
        function resBgColor(bg_color) {
            // 當color值大於128時 color值偏向255 即#ffffff (偏淺色)
            // 此時字體顏色應為 黑色=#000000
            // 當color值小於128時 color值偏向0 即#000000 (偏深色)
            // 此時字體颜色應為 白色=#ffffff
            var color = 0.213 * bg_color[0] + 0.715 * bg_color[1] + 0.072 * bg_color[2] > 255 / 2;
            return color ? '#000000' : '#ffffff'
        }




    </script>
</body>

</html>